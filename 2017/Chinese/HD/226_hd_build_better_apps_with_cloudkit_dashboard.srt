1
00:00:17,551 --> 00:00:23,857 line:10%
<c.magenta>（用CloudKit Dashboard</c>
<c.magenta>创建更好的应用）</c>


2
00:00:26,960 --> 00:00:27,794 line:90%,end
<c.magenta>早上好</c>


3
00:00:28,095 --> 00:00:29,263 line:90%,end
<c.magenta>我是戴夫·布朗宁</c>


4
00:00:29,329 --> 00:00:31,031 line:90%,end
<c.magenta>我是Apple CloudKit团队的一员</c>


5
00:00:31,632 --> 00:00:34,635 line:90%,end
<c.magenta>能向大家介绍CloudKit中的新功能</c>
<c.magenta>我感到很激动</c>


6
00:00:34,735 --> 00:00:36,937 line:90%,end
<c.magenta>特别是一个全新的</c>
<c.magenta>CloudKit Dashboard</c>


7
00:00:37,604 --> 00:00:38,805 line:90%,end
<c.magenta>如果你不熟悉它</c>


8
00:00:38,872 --> 00:00:41,575 line:90%,end
<c.magenta>Dashboard就是一个网络应用</c>


9
00:00:41,642 --> 00:00:44,378 line:90%,end
<c.magenta>帮助你将CloudKit功能</c>
<c.magenta>添加到你的应用中</c>


10
00:00:46,180 --> 00:00:48,782 line:90%,end
<c.magenta>那么首先 我想谈谈我们的一些目标</c>


11
00:00:48,849 --> 00:00:50,617 line:90%,end
<c.magenta>在我们今天要发布的东西背后的目标</c>


12
00:00:50,851 --> 00:00:54,354 line:90%,end
<c.magenta>并在高级层面上</c>
<c.magenta>正如这场演讲的标题</c>


13
00:00:54,955 --> 00:00:58,392 line:90%,end
<c.magenta>我们非常希望能帮助你们</c>
<c.magenta>在CloudKit上创建更好的应用</c>


14
00:00:59,026 --> 00:01:01,161 line:90%,end
<c.magenta>并且我们希望可以通过</c>
<c.magenta>许多不同的方式实现</c>


15
00:01:01,995 --> 00:01:05,732 line:90%,end
<c.magenta>首先我们想帮助你了解一下</c>
<c.magenta>你应用生命周期的各个阶段</c>


16
00:01:06,400 --> 00:01:08,235 line:90%,end
<c.magenta>当你第一次了解到CloudKit时</c>


17
00:01:08,302 --> 00:01:11,405 line:90%,end
<c.magenta>当你刚开始</c>
<c.magenta>将功能创建到你的应用中时</c>


18
00:01:11,471 --> 00:01:13,207 line:90%,end
<c.magenta>当你让用户进行beta测试时</c>


19
00:01:13,507 --> 00:01:14,875 line:90%,end
<c.magenta>当你把应用放在App Store中时</c>


20
00:01:14,942 --> 00:01:16,810 line:90%,end
<c.magenta>成为成品 规模扩大</c>


21
00:01:16,877 --> 00:01:18,679 line:90%,end
<c.magenta>真正开始打造你的用户体验</c>


22
00:01:19,012 --> 00:01:22,349 line:90%,end
<c.magenta>然后最终 可能还会支持</c>
<c.magenta>运营中可能出现的客户端问题</c>


23
00:01:22,916 --> 00:01:26,587 line:90%,end
<c.magenta>我们想给你提供一些必要的工具</c>
<c.magenta>来帮助你应对以上各个阶段</c>


24
00:01:28,689 --> 00:01:32,159 line:90%,end
<c.magenta>我们还想为你提供一个</c>
<c.magenta>能用整个API进行试验的方式</c>


25
00:01:32,426 --> 00:01:34,494 line:90%,end
<c.magenta>现在很明显</c>
<c.magenta>你可以直接跳到XCode</c>


26
00:01:34,795 --> 00:01:37,598 line:90%,end
<c.magenta>并开始使用我们的API</c>
<c.magenta>然后了解它的工作机制</c>


27
00:01:37,865 --> 00:01:40,434 line:90%,end
<c.magenta>但我们想为你们提供一个</c>
<c.magenta>除Xcode之外的东西</c>


28
00:01:40,567 --> 00:01:43,136 line:90%,end
<c.magenta>可以让你可视化地使用同一个API</c>


29
00:01:43,337 --> 00:01:46,139 line:90%,end
<c.magenta>从而你可以用它做试验</c>
<c.magenta>了解它的机制</c>


30
00:01:46,373 --> 00:01:49,142 line:90%,end
<c.magenta>当你正在将那个功能</c>
<c.magenta>创建到你的应用中时</c>


31
00:01:50,911 --> 00:01:54,147 line:90%,end
<c.magenta>我们还想让整个系统中的</c>
<c.magenta>全部事件可视化</c>


32
00:01:54,214 --> 00:01:55,649 line:90%,end
<c.magenta>让全部用户的全部事件可视化</c>


33
00:01:56,083 --> 00:01:58,552 line:90%,end
<c.magenta>尤其是当你把应用放到App Store中</c>


34
00:01:58,619 --> 00:02:00,120 line:90%,end
<c.magenta>用户基数不断增长时</c>


35
00:02:00,420 --> 00:02:03,156 line:90%,end
<c.magenta>我们想帮助你了解群体行为</c>


36
00:02:03,223 --> 00:02:06,793 line:90%,end
<c.magenta>全部用户在CloudKit服务器上的通讯</c>


37
00:02:09,395 --> 00:02:11,365 line:90%,end
<c.magenta>在跳到一个Dashboard的演示之前</c>


38
00:02:11,431 --> 00:02:12,666 line:90%,end
<c.magenta>我想做两件事</c>


39
00:02:12,966 --> 00:02:16,470 line:90%,end
<c.magenta>首先让我们</c>
<c.magenta>快速回顾一些CloudKit概念</c>


40
00:02:16,670 --> 00:02:19,039 line:90%,end
<c.magenta>若你用过CloudKit</c>
<c.magenta>你肯定很熟悉其中一些东西</c>


41
00:02:19,106 --> 00:02:21,175 line:90%,end
<c.magenta>但这是一个好的基础</c>
<c.magenta>如果你没有用过它的话</c>


42
00:02:21,241 --> 00:02:23,443 line:90%,end
<c.magenta>因为我要在整场演讲中使用这些概念</c>


43
00:02:23,944 --> 00:02:25,646 line:90%,end
<c.magenta>然后</c>


44
00:02:25,779 --> 00:02:27,881 line:90%,end
<c.magenta>我要给你们演示</c>


45
00:02:27,948 --> 00:02:29,616 line:90%,end
<c.magenta>一个示例iOS应用</c>


46
00:02:29,683 --> 00:02:31,552 line:90%,end
<c.magenta>是我们在CloudKit上创建的</c>


47
00:02:31,718 --> 00:02:34,321 line:90%,end
<c.magenta>要在讲解Dashboard时演示</c>


48
00:02:34,454 --> 00:02:36,223 line:90%,end
<c.magenta>展示Dashboard</c>
<c.magenta>会如何提供帮助</c>


49
00:02:36,290 --> 00:02:38,125 line:90%,end
<c.magenta>当你测试和创建应用时</c>


50
00:02:38,659 --> 00:02:40,928 line:90%,end
<c.magenta>好了 那么首先是一些CloudKit概念</c>


51
00:02:41,828 --> 00:02:42,896 line:90%,end
<c.magenta>迄今为止</c>


52
00:02:43,197 --> 00:02:45,465 line:90%,end
<c.magenta>你们都用API把记录存储</c>


53
00:02:45,599 --> 00:02:46,867 line:90%,end
<c.magenta>回CloudKit服务器</c>


54
00:02:47,401 --> 00:02:48,702 line:90%,end
<c.magenta>这是你的结构化数据</c>


55
00:02:48,769 --> 00:02:50,070 line:90%,end
<c.magenta>你的键和值</c>


56
00:02:50,237 --> 00:02:52,306 line:90%,end
<c.magenta>提示一下 值可以是不同的类型</c>


57
00:02:52,372 --> 00:02:54,575 line:90%,end
<c.magenta>strings、ints、doubles、asset</c>


58
00:02:54,641 --> 00:02:55,776 line:90%,end
<c.magenta>asset是一个二进制文件</c>


59
00:02:56,510 --> 00:02:57,644 line:90%,end
<c.magenta>当你存储记录时</c>


60
00:02:57,744 --> 00:03:00,347 line:90%,end
<c.magenta>它总是存在于一个叫作区的内部</c>


61
00:03:00,881 --> 00:03:03,016 line:90%,end
<c.magenta>区其实就是一堆记录</c>


62
00:03:03,217 --> 00:03:04,785 line:90%,end
<c.magenta>它是我们要谈到的</c>


63
00:03:04,852 --> 00:03:07,120 line:90%,end
<c.magenta>一些API的基础功能</c>


64
00:03:07,754 --> 00:03:10,157 line:90%,end
<c.magenta>区总是存在于数据库中</c>


65
00:03:10,524 --> 00:03:13,026 line:90%,end
<c.magenta>有些数据库允许你创建不同的区</c>


66
00:03:13,093 --> 00:03:15,195 line:90%,end
<c.magenta>如果你需要</c>
<c.magenta>以不同方式进行记录的话</c>


67
00:03:16,096 --> 00:03:19,066 line:90%,end
<c.magenta>你的所有用户都有自己的私密数据库</c>


68
00:03:19,166 --> 00:03:20,934 line:90%,end
<c.magenta>这是你存储他们私密数据的地方</c>


69
00:03:21,001 --> 00:03:22,236 line:90%,end
<c.magenta>只有他们自己能看到</c>


70
00:03:23,203 --> 00:03:25,906 line:90%,end
<c.magenta>他们还拥有自己的共享数据库</c>


71
00:03:26,139 --> 00:03:28,942 line:90%,end
<c.magenta>这是因为</c>
<c.magenta>去年我们发布了CloudKit共享</c>


72
00:03:29,376 --> 00:03:31,979 line:90%,end
<c.magenta>如果你的一个用户</c>
<c.magenta>与其他用户共享数据</c>


73
00:03:32,045 --> 00:03:34,214 line:90%,end
<c.magenta>那么数据就会在他们的</c>
<c.magenta>共享数据库中显示</c>


74
00:03:34,314 --> 00:03:35,816 line:90%,end
<c.magenta>你可以把它看作一个代理</c>


75
00:03:35,883 --> 00:03:37,651 line:90%,end
<c.magenta>可以返回到所有者的私密数据库</c>


76
00:03:38,452 --> 00:03:40,454 line:90%,end
<c.magenta>那么最后 还有一个公共数据库</c>


77
00:03:40,554 --> 00:03:43,390 line:90%,end
<c.magenta>每个人都能读写 这是其中之一</c>


78
00:03:44,491 --> 00:03:46,426 line:90%,end
<c.magenta>全部数据 全部数据库</c>


79
00:03:46,493 --> 00:03:48,195 line:90%,end
<c.magenta>都处于一个环境内</c>


80
00:03:48,762 --> 00:03:50,163 line:90%,end
<c.magenta>当你正在创建你的应用时</c>


81
00:03:50,230 --> 00:03:51,899 line:90%,end
<c.magenta>就是开发环境</c>


82
00:03:52,199 --> 00:03:54,535 line:90%,end
<c.magenta>在环境层级上 你定义你的机制</c>


83
00:03:54,668 --> 00:03:57,171 line:90%,end
<c.magenta>你的记录类型 你要存储的数据类型</c>


84
00:03:57,437 --> 00:03:59,806 line:90%,end
<c.magenta>也许还有索引 如果你要查询它的话</c>


85
00:04:00,741 --> 00:04:02,409 line:90%,end
<c.magenta>现在你正在用开发环境</c>


86
00:04:02,476 --> 00:04:03,377 line:90%,end
<c.magenta>因为你正在创建你的应用</c>


87
00:04:03,577 --> 00:04:05,245 line:90%,end
<c.magenta>然后一旦你把应用放在商店中</c>


88
00:04:05,312 --> 00:04:06,980 line:90%,end
<c.magenta>那就是在生产环境中了</c>


89
00:04:07,748 --> 00:04:10,017 line:90%,end
<c.magenta>那么我们提供了一种</c>
<c.magenta>将机制变更放入</c>


90
00:04:10,083 --> 00:04:11,518 line:90%,end
<c.magenta>生产环境中的方法</c>


91
00:04:11,919 --> 00:04:13,887 line:90%,end
<c.magenta>那么在生产环境中时</c>
<c.magenta>你的全部用户</c>


92
00:04:13,954 --> 00:04:16,890 line:90%,end
<c.magenta>都有自己的私密数据库、</c>
<c.magenta>共享数据库和一个公共数据库</c>


93
00:04:17,024 --> 00:04:18,625 line:90%,end
<c.magenta>与开发环境脱离</c>


94
00:04:19,125 --> 00:04:21,827 line:90%,end
<c.magenta>然后这些全部都处于</c>
<c.magenta>最高层级的概念中</c>


95
00:04:21,962 --> 00:04:22,963 line:90%,end
<c.magenta>即容器</c>


96
00:04:23,497 --> 00:04:25,098 line:90%,end
<c.magenta>容器有一个唯一标识符</c>


97
00:04:25,232 --> 00:04:27,768 line:90%,end
<c.magenta>它通常对你的应用进行一对一映射</c>


98
00:04:28,869 --> 00:04:30,737 line:90%,end
<c.magenta>好的 这就是CloudKit概念</c>


99
00:04:31,071 --> 00:04:33,540 line:90%,end
<c.magenta>我刚才提到过 我们在CloudKit上</c>
<c.magenta>创建了一个示例应用</c>


100
00:04:33,607 --> 00:04:36,410 line:90%,end
<c.magenta>是我今天要在演示中使用的</c>


101
00:04:36,710 --> 00:04:37,811 line:90%,end
<c.magenta>那么让我们谈谈它吧</c>


102
00:04:38,412 --> 00:04:40,614 line:90%,end
<c.magenta>它是一个计划列表应用</c>
<c.magenta>一个古老的例子</c>


103
00:04:40,681 --> 00:04:41,815 line:90%,end
<c.magenta>它相对简单</c>


104
00:04:42,049 --> 00:04:44,418 line:90%,end
<c.magenta>我们的想法是用户可以创建计划列表</c>


105
00:04:44,484 --> 00:04:46,220 line:90%,end
<c.magenta>并且他们可以在每一个列表内</c>
<c.magenta>包含几个列表项</c>


106
00:04:46,520 --> 00:04:48,789 line:90%,end
<c.magenta>那么让我们谈谈</c>
<c.magenta>我们要使用的数据模型</c>


107
00:04:48,856 --> 00:04:51,258 line:90%,end
<c.magenta>因为我们要把这个存回到CloudKit中</c>


108
00:04:52,259 --> 00:04:55,095 line:90%,end
<c.magenta>那么每次当你的用户</c>
<c.magenta>在应用中创建计划列表时</c>


109
00:04:55,762 --> 00:04:57,764 line:90%,end
<c.magenta>我们就会在服务器上</c>
<c.magenta>创建一个列表记录</c>


110
00:04:58,632 --> 00:05:00,501 line:90%,end
<c.magenta>无论何时用户在列表内创建列表项时</c>


111
00:05:00,567 --> 00:05:02,269 line:90%,end
<c.magenta>我们都会记录每一个项的记录</c>


112
00:05:02,503 --> 00:05:05,072 line:90%,end
<c.magenta>我们需要一种方式能将列表项</c>


113
00:05:05,138 --> 00:05:06,940 line:90%,end
<c.magenta>指回它所属的列表</c>


114
00:05:07,074 --> 00:05:09,176 line:90%,end
<c.magenta>在CloudKit中</c>
<c.magenta>你可以通过引用实现</c>


115
00:05:09,543 --> 00:05:12,613 line:90%,end
<c.magenta>其实是通过一个指针的标识符</c>
<c.magenta>返回到另一个记录</c>


116
00:05:13,146 --> 00:05:16,617 line:90%,end
<c.magenta>在本例中 我们要使用一个</c>
<c.magenta>叫作parent的引用</c>


117
00:05:16,950 --> 00:05:18,852 line:90%,end
<c.magenta>Parent引用是一个系统字段</c>


118
00:05:18,919 --> 00:05:20,354 line:90%,end
<c.magenta>依赖于每一条记录而存在</c>


119
00:05:20,521 --> 00:05:21,755 line:90%,end
<c.magenta>默认情况下有parent引用</c>


120
00:05:22,422 --> 00:05:25,626 line:90%,end
<c.magenta>而且它在CloudKit中的存在方式是</c>
<c.magenta>你可以很有逻辑地告诉服务器</c>


121
00:05:25,959 --> 00:05:27,294 line:90%,end
<c.magenta>当某个东西有parent引用时</c>


122
00:05:27,361 --> 00:05:30,197 line:90%,end
<c.magenta>那么在本例中</c>
<c.magenta>我们把列表项指回列表记录</c>


123
00:05:30,297 --> 00:05:31,665 line:90%,end
<c.magenta>通过这个parent引用</c>


124
00:05:32,432 --> 00:05:34,268 line:90%,end
<c.magenta>现在 在这个示例应用中 我们还想</c>


125
00:05:34,434 --> 00:05:36,069 line:90%,end
<c.magenta>允许我们的用户</c>


126
00:05:36,203 --> 00:05:38,138 line:90%,end
<c.magenta>安全地共享计划列表</c>


127
00:05:38,205 --> 00:05:40,274 line:90%,end
<c.magenta>与其他使用CloudKit共享的用户一起</c>


128
00:05:40,974 --> 00:05:42,743 line:90%,end
<c.magenta>那么这就是在数据模型中的运作</c>


129
00:05:43,577 --> 00:05:46,613 line:90%,end
<c.magenta>我们的列表记录将会是一个</c>
<c.magenta>叫作根记录的东西</c>


130
00:05:46,847 --> 00:05:48,482 line:90%,end
<c.magenta>它会指向一个共享记录</c>


131
00:05:48,749 --> 00:05:50,851 line:90%,end
<c.magenta>共享是你定义参与者集合</c>


132
00:05:50,918 --> 00:05:52,052 line:90%,end
<c.magenta>及其权限的地方</c>


133
00:05:52,419 --> 00:05:54,488 line:90%,end
<c.magenta>因为我们使用parent应用</c>


134
00:05:54,555 --> 00:05:56,223 line:90%,end
<c.magenta>将列表项指回到列表</c>


135
00:05:56,490 --> 00:05:58,926 line:90%,end
<c.magenta>共享中将自动包含这些</c>


136
00:05:59,026 --> 00:06:00,727 line:90%,end
<c.magenta>你不必再单独进行共享</c>


137
00:06:02,262 --> 00:06:03,797 line:90%,end
<c.magenta>要了解关于共享的更多信息</c>


138
00:06:04,064 --> 00:06:06,300 line:90%,end
<c.magenta>请回去观看我们去年的演讲</c>


139
00:06:06,366 --> 00:06:07,267 line:90%,end
<c.magenta>“CloudKit新特性”</c>


140
00:06:08,202 --> 00:06:10,671 line:90%,end
<c.magenta>好的 那么这是如何存储数据</c>


141
00:06:10,938 --> 00:06:13,540 line:90%,end
<c.magenta>现在让我们谈谈我们要使用的API</c>


142
00:06:13,707 --> 00:06:15,876 line:90%,end
<c.magenta>以及我们要如何应答服务器</c>


143
00:06:16,610 --> 00:06:18,612 line:90%,end
<c.magenta>我们希望这个应用的功能是</c>


144
00:06:18,912 --> 00:06:21,682 line:90%,end
<c.magenta>如果用户打开应用并创建计划列表</c>


145
00:06:21,748 --> 00:06:23,283 line:90%,end
<c.magenta>用他们iPhone上的东西</c>


146
00:06:23,417 --> 00:06:24,785 line:90%,end
<c.magenta>但他们还有一个iPad</c>


147
00:06:24,852 --> 00:06:26,019 line:90%,end
<c.magenta>并且他们也在iPad上运行应用</c>


148
00:06:26,086 --> 00:06:27,855 line:90%,end
<c.magenta>我们想同步那个数据</c>


149
00:06:28,288 --> 00:06:30,023 line:90%,end
<c.magenta>因为我们用了共享</c>


150
00:06:30,257 --> 00:06:31,692 line:90%,end
<c.magenta>如果我与他人共享一个列表</c>


151
00:06:31,758 --> 00:06:33,260 line:90%,end
<c.magenta>并且其中一人对它进行了编辑</c>


152
00:06:33,393 --> 00:06:35,362 line:90%,end
<c.magenta>我们希望另一方也能看到这些编辑</c>


153
00:06:36,196 --> 00:06:37,564 line:90%,end
<c.magenta>那么我们有一个核心数据</c>


154
00:06:37,631 --> 00:06:40,200 line:90%,end
<c.magenta>我们在核心数据中</c>
<c.magenta>进行全部数据的本地存储</c>


155
00:06:40,267 --> 00:06:42,135 line:90%,end
<c.magenta>目的是快速读取</c>


156
00:06:42,202 --> 00:06:43,604 line:90%,end
<c.magenta>以及离线访问</c>


157
00:06:44,438 --> 00:06:46,340 line:90%,end
<c.magenta>但是每次有修改时</c>


158
00:06:46,406 --> 00:06:49,476 line:90%,end
<c.magenta>当有可用的网络时</c>
<c.magenta>我们就想把那个修改传回服务器</c>


159
00:06:49,977 --> 00:06:51,411 line:90%,end
<c.magenta>服务器持有真相</c>


160
00:06:51,845 --> 00:06:55,449 line:90%,end
<c.magenta>并且如果我们在CloudKit中</c>
<c.magenta>使用一个叫作订阅的东西</c>


161
00:06:55,716 --> 00:06:58,151 line:90%,end
<c.magenta>我们可以让服务器发送推送通知</c>


162
00:06:58,218 --> 00:07:01,221 line:90%,end
<c.magenta>到我的其它设备或其他用户的设备</c>


163
00:07:01,421 --> 00:07:03,624 line:90%,end
<c.magenta>无论何时他们注意到有修改时</c>


164
00:07:03,857 --> 00:07:05,926 line:90%,end
<c.magenta>那么这就是在示例应用中的实现方式</c>


165
00:07:06,393 --> 00:07:07,528 line:90%,end
<c.magenta>首次运行它时</c>


166
00:07:07,895 --> 00:07:10,163 line:90%,end
<c.magenta>我们要在服务器上</c>


167
00:07:10,264 --> 00:07:13,200 line:90%,end
<c.magenta>给用户的私密数据库</c>
<c.magenta>创建一个CKDatabaseSubscription</c>


168
00:07:13,400 --> 00:07:15,736 line:90%,end
<c.magenta>那会告诉服务器发送推送通知</c>


169
00:07:15,802 --> 00:07:17,137 line:90%,end
<c.magenta>到用户的设备</c>


170
00:07:17,337 --> 00:07:20,741 line:90%,end
<c.magenta>无论何时他们的私密数据发生变更时</c>
<c.magenta>就是在他们私密数据库中的任意数据</c>


171
00:07:21,441 --> 00:07:23,076 line:90%,end
<c.magenta>因为我们用了共享</c>


172
00:07:23,510 --> 00:07:26,013 line:90%,end
<c.magenta>我们在用户的共享数据库中还要</c>
<c.magenta>设置一个订阅</c>


173
00:07:26,346 --> 00:07:28,582 line:90%,end
<c.magenta>CloudKit现在可以发送推送通知</c>


174
00:07:28,649 --> 00:07:32,019 line:90%,end
<c.magenta>到用户的设备了</c>
<c.magenta>当其中一个数据库中的数据发生变更时</c>


175
00:07:33,320 --> 00:07:35,856 line:90%,end
<c.magenta>一旦我们在我们的应用中</c>
<c.magenta>收到其中一条推送通知</c>


176
00:07:36,123 --> 00:07:39,193 line:90%,end
<c.magenta>或当应用启动时</c>
<c.magenta>我们需要一种方式可以请求服务器</c>


177
00:07:39,293 --> 00:07:41,361 line:90%,end
<c.magenta>提供之前没有的那些新改动</c>


178
00:07:41,562 --> 00:07:46,767 line:90%,end
<c.magenta>我们要通过CKFetchDatabaseChanges</c>
<c.magenta>Operation实现</c>


179
00:07:47,234 --> 00:07:48,335 line:90%,end
<c.magenta>这会请求服务器说</c>


180
00:07:48,402 --> 00:07:50,304 line:90%,end
<c.magenta>“请告诉我哪个区发生了变更”</c>


181
00:07:50,370 --> 00:07:53,473 line:90%,end
<c.magenta>还记得我们之前提到过的区吧</c>
<c.magenta>“这个数据库里的 ”</c>


182
00:07:53,740 --> 00:07:55,108 line:90%,end
<c.magenta>且若其中有一个区发生了变更</c>


183
00:07:55,175 --> 00:07:56,076 line:90%,end
<c.magenta>我们就可以转过去</c>


184
00:07:56,143 --> 00:07:59,313 line:90%,end
<c.magenta>请求服务器提供那个区内的</c>
<c.magenta>哪些记录发生了变更</c>


185
00:07:59,379 --> 00:08:00,681 line:90%,end
<c.magenta>或者哪些区</c>


186
00:08:00,747 --> 00:08:03,350 line:90%,end
<c.magenta>通过CKFetchRecordZoneChanges</c>
<c.magenta>Operation实现</c>


187
00:08:05,219 --> 00:08:07,621 line:90%,end
<c.magenta>要了解更多信息</c>
<c.magenta>请观看去年的演讲</c>


188
00:08:07,688 --> 00:08:09,122 line:90%,end
<c.magenta>“CloudKit最佳实践”</c>


189
00:08:09,489 --> 00:08:11,959 line:90%,end
<c.magenta>因为这是一个如此常用的流程</c>


190
00:08:12,159 --> 00:08:13,727 line:90%,end
<c.magenta>我们已经添加了新的文档 叫作</c>


191
00:08:13,794 --> 00:08:16,296 line:90%,end
<c.magenta>“维护CloudKit记录的本地缓存”</c>


192
00:08:16,496 --> 00:08:17,965 line:90%,end
<c.magenta>那将会带你逐步熟悉这个流程</c>


193
00:08:18,031 --> 00:08:19,466 line:90%,end
<c.magenta>并给你提供一堆Swift代码</c>


194
00:08:19,533 --> 00:08:21,468 line:90%,end
<c.magenta>以便你可以在应用中使用</c>


195
00:08:24,137 --> 00:08:26,940 line:90%,end
<c.magenta>现在 因为获取变更</c>
<c.magenta>是一件如此常见的事</c>


196
00:08:27,007 --> 00:08:29,343 line:90%,end
<c.magenta>我们创建了一个</c>
<c.magenta>可以了解和试验它的功能</c>


197
00:08:29,409 --> 00:08:30,777 line:90%,end
<c.magenta>就在Dashboard中</c>


198
00:08:31,345 --> 00:08:32,446 line:90%,end
<c.magenta>那么 让我们来看看</c>


199
00:08:34,214 --> 00:08:35,616 line:90%,end
<c.magenta>好了 那么在屏幕上</c>


200
00:08:36,049 --> 00:08:37,183 line:90%,end
<c.magenta>在左侧</c>


201
00:08:37,251 --> 00:08:38,885 line:90%,end
<c.magenta>你可以看到新的</c>
<c.magenta>CloudKit Dashboard</c>


202
00:08:39,052 --> 00:08:42,222 line:90%,end
<c.magenta>而在右侧</c>
<c.magenta>我正在共享这台iPhone的屏幕</c>


203
00:08:42,356 --> 00:08:44,191 line:90%,end
<c.magenta>正在运行那个计划列表示例应用</c>


204
00:08:44,258 --> 00:08:45,325 line:90%,end
<c.magenta>我之前提到过的那个</c>


205
00:08:46,727 --> 00:08:49,930 line:90%,end
<c.magenta>如果你看一下Dashboard</c>
<c.magenta>我们现在主页</c>


206
00:08:50,163 --> 00:08:51,999 line:90%,end
<c.magenta>我用我的开发人员账户登录了</c>


207
00:08:52,633 --> 00:08:55,536 line:90%,end
<c.magenta>你能看到的第一个东西就是</c>
<c.magenta>你的全部开发者团队</c>


208
00:08:55,602 --> 00:08:56,937 line:90%,end
<c.magenta>是你所参与的全部团队</c>


209
00:08:57,004 --> 00:08:58,739 line:90%,end
<c.magenta>因为你也许不只是一个团队中的一员</c>


210
00:08:59,573 --> 00:09:00,507 line:90%,end
<c.magenta>对于每个团队</c>


211
00:09:00,574 --> 00:09:03,577 line:90%,end
<c.magenta>你可以看到那个团队</c>
<c.magenta>所拥有的CloudKit容器</c>


212
00:09:03,977 --> 00:09:06,547 line:90%,end
<c.magenta>并且你可以快速查看</c>
<c.magenta>哪个被部署为生产</c>


213
00:09:06,613 --> 00:09:08,215 line:90%,end
<c.magenta>以及哪个正在开发</c>


214
00:09:09,049 --> 00:09:11,084 line:90%,end
<c.magenta>如果你有一大堆团队或一大堆容器</c>


215
00:09:11,151 --> 00:09:12,986 line:90%,end
<c.magenta>你总能通过顶部的筛选器筛选列表</c>


216
00:09:14,087 --> 00:09:15,956 line:90%,end
<c.magenta>现在本例中 这是我用于</c>


217
00:09:16,023 --> 00:09:18,692 line:90%,end
<c.magenta>我正在演示的这个示例应用的容器</c>
<c.magenta>让我们点击进入</c>


218
00:09:20,160 --> 00:09:21,628 line:90%,end
<c.magenta>当你点进一个容器时</c>


219
00:09:21,828 --> 00:09:23,964 line:90%,end
<c.magenta>你可以看到开发环境和生产环境</c>


220
00:09:24,031 --> 00:09:25,966 line:90%,end
<c.magenta>我之前提到过的 并排</c>


221
00:09:26,533 --> 00:09:28,569 line:90%,end
<c.magenta>在本例中 我们用的是开发环境</c>


222
00:09:28,635 --> 00:09:30,504 line:90%,end
<c.magenta>因为我仍然还在创建这个示例应用</c>


223
00:09:30,771 --> 00:09:34,474 line:90%,end
<c.magenta>那么让我们点进数据部分</c>
<c.magenta>并点进一个叫作区的标签</c>


224
00:09:35,709 --> 00:09:39,079 line:90%,end
<c.magenta>这会让你了解</c>
<c.magenta>CloudKit中的区API</c>


225
00:09:39,246 --> 00:09:40,581 line:90%,end
<c.magenta>你可以请求服务器</c>


226
00:09:40,781 --> 00:09:43,617 line:90%,end
<c.magenta>显示某一个数据库内的区信息</c>


227
00:09:44,184 --> 00:09:45,819 line:90%,end
<c.magenta>现在本例中 我想给你们展示</c>


228
00:09:45,886 --> 00:09:49,456 line:90%,end
<c.magenta>我用我的开发人员账户</c>
<c.magenta>登录了Dashboard</c>


229
00:09:50,023 --> 00:09:54,127 line:90%,end
<c.magenta>那个Apple ID</c>
<c.magenta>与我的设备上的Apple ID一样</c>


230
00:09:54,194 --> 00:09:55,596 line:90%,end
<c.magenta>只是我的私人iCloud账户</c>


231
00:09:55,662 --> 00:09:56,997 line:90%,end
<c.magenta>和我的开发人员账户</c>


232
00:09:57,731 --> 00:09:59,967 line:90%,end
<c.magenta>因为这是我的私人iCloud账户</c>


233
00:10:00,267 --> 00:10:03,070 line:90%,end
<c.magenta>我可以看到我的私密数据库</c>
<c.magenta>和共享数据库</c>


234
00:10:03,770 --> 00:10:05,672 line:90%,end
<c.magenta>在这里 Dashboard询问说</c>


235
00:10:05,739 --> 00:10:08,809 line:90%,end
<c.magenta>“你要从这个账户的私密数据库</c>


236
00:10:08,942 --> 00:10:10,911 line:90%,end
<c.magenta>共享数据库或公共数据库中</c>
<c.magenta>加载区信息吗？”</c>


237
00:10:11,345 --> 00:10:12,913 line:90%,end
<c.magenta>让我们加载私密数据库的区信息</c>


238
00:10:13,780 --> 00:10:15,983 line:90%,end
<c.magenta>因为我们要使用获取变更API</c>


239
00:10:16,049 --> 00:10:18,185 line:90%,end
<c.magenta>我们得勾选这个复选框来获取</c>


240
00:10:18,252 --> 00:10:21,922 line:90%,end
<c.magenta>在指定时间点后这个数据库内</c>
<c.magenta>发生变更的区信息</c>


241
00:10:22,656 --> 00:10:26,493 line:90%,end
<c.magenta>现在这个API会允许</c>
<c.magenta>你指定一个变更标记</c>


242
00:10:26,593 --> 00:10:28,962 line:90%,end
<c.magenta>标记你曾经进行同步的位置</c>


243
00:10:29,796 --> 00:10:32,432 line:90%,end
<c.magenta>你可以在这里应用那个变更标记</c>
<c.magenta>现在是空的</c>


244
00:10:32,499 --> 00:10:35,636 line:90%,end
<c.magenta>这会告诉服务器说我们希望获得</c>
<c.magenta>在该数据库内所发生的全部变更</c>


245
00:10:35,769 --> 00:10:36,970 line:90%,end
<c.magenta>从一开始</c>


246
00:10:38,238 --> 00:10:40,407 line:90%,end
<c.magenta>若我获取变更</c>
<c.magenta>你可以看到我们得到了一个结果</c>


247
00:10:41,008 --> 00:10:43,277 line:90%,end
<c.magenta>这个计划区是那个</c>


248
00:10:43,343 --> 00:10:46,980 line:90%,end
<c.magenta>我的应用在这个设备上</c>
<c.magenta>首次运行时所创建的区</c>


249
00:10:47,214 --> 00:10:49,283 line:90%,end
<c.magenta>你可以在这里存储将来随着用户</c>


250
00:10:49,349 --> 00:10:52,686 line:90%,end
<c.magenta>创建计划列表和列表项</c>
<c.magenta>而需要保存的记录</c>


251
00:10:53,587 --> 00:10:56,089 line:90%,end
<c.magenta>请注意 服务器返回了一个变更标记</c>


252
00:10:56,256 --> 00:10:58,425 line:90%,end
<c.magenta>自动填充了这个字段</c>


253
00:10:58,692 --> 00:11:00,627 line:90%,end
<c.magenta>标记了我们向前移动的时间</c>


254
00:11:01,161 --> 00:11:03,730 line:90%,end
<c.magenta>那么如果我再次用这个标记获取变更</c>


255
00:11:04,131 --> 00:11:06,767 line:90%,end
<c.magenta>服务器显示“目前没有区发生变更 ”</c>


256
00:11:06,834 --> 00:11:07,868 line:90%,end
<c.magenta>那么我们现在有最新数据</c>


257
00:11:09,169 --> 00:11:10,470 line:90%,end
<c.magenta>现在 如果我清除那个标记</c>


258
00:11:10,604 --> 00:11:12,139 line:90%,end
<c.magenta>然后返回到最开始</c>


259
00:11:12,206 --> 00:11:13,540 line:90%,end
<c.magenta>我们会看到我的计划区</c>


260
00:11:14,241 --> 00:11:15,542 line:90%,end
<c.magenta>如果我将鼠标悬浮在这行上</c>


261
00:11:15,843 --> 00:11:17,744 line:90%,end
<c.magenta>Dashboard</c>
<c.magenta>就给出了一个便利的小链接</c>


262
00:11:17,845 --> 00:11:21,348 line:90%,end
<c.magenta>那个链接可以让我们进入</c>
<c.magenta>并获取这个区内所发生的记录变更</c>


263
00:11:21,682 --> 00:11:22,516 line:90%,end
<c.magenta>那么让我们来试试</c>


264
00:11:23,884 --> 00:11:25,919 line:90%,end
<c.magenta>请注意这会将我们带到记录标签</c>


265
00:11:26,353 --> 00:11:28,021 line:90%,end
<c.magenta>它选择了我的私密数据库</c>


266
00:11:28,455 --> 00:11:30,324 line:90%,end
<c.magenta>然后是我刚点击过的计划区</c>


267
00:11:30,557 --> 00:11:33,827 line:90%,end
<c.magenta>然后它认为我们</c>
<c.magenta>想用获取变更API加载记录</c>


268
00:11:34,127 --> 00:11:35,963 line:90%,end
<c.magenta>在右侧我们可以看到两个结果</c>


269
00:11:36,463 --> 00:11:38,232 line:90%,end
<c.magenta>第一个是一个列表记录</c>


270
00:11:38,565 --> 00:11:40,200 line:90%,end
<c.magenta>如果你看一下屏幕右侧</c>


271
00:11:40,267 --> 00:11:42,135 line:90%,end
<c.magenta>你就会看到了 这是因为</c>
<c.magenta>我已经在我的应用中创建了</c>


272
00:11:42,202 --> 00:11:43,637 line:90%,end
<c.magenta>一个计划列表</c>


273
00:11:43,704 --> 00:11:45,005 line:90%,end
<c.magenta>假期点子</c>


274
00:11:45,339 --> 00:11:47,140 line:90%,end
<c.magenta>然后它就把那个存回到服务器</c>


275
00:11:47,274 --> 00:11:49,309 line:90%,end
<c.magenta>所以服务器就告诉我们那个变更</c>


276
00:11:50,310 --> 00:11:51,345 line:90%,end
<c.magenta>我们还可以看到一条共享记录</c>


277
00:11:51,411 --> 00:11:52,813 line:90%,end
<c.magenta>但我们稍后再看这个</c>


278
00:11:53,680 --> 00:11:55,649 line:90%,end
<c.magenta>与获取数据库变更类似</c>


279
00:11:55,716 --> 00:11:57,117 line:90%,end
<c.magenta>当你获取区变更时</c>


280
00:11:57,184 --> 00:11:58,585 line:90%,end
<c.magenta>服务器就给我们返回</c>


281
00:11:58,752 --> 00:12:01,488 line:90%,end
<c.magenta>变更标记 是我们所在的历史位置</c>


282
00:12:01,822 --> 00:12:03,590 line:90%,end
<c.magenta>那么如果我再次获取变更</c>


283
00:12:03,790 --> 00:12:06,960 line:90%,end
<c.magenta>它会表明这个区内没有新的记录变更</c>


284
00:12:07,027 --> 00:12:08,228 line:90%,end
<c.magenta>自那时起</c>


285
00:12:09,463 --> 00:12:11,832 line:90%,end
<c.magenta>好了 现在让我们看看iOS应用</c>


286
00:12:12,032 --> 00:12:13,967 line:90%,end
<c.magenta>并创建一个新的计划列表</c>


287
00:12:14,501 --> 00:12:15,335 line:90%,end
<c.magenta>或者 也许不创建</c>


288
00:12:19,439 --> 00:12:20,941 line:90%,end
<c.magenta>嗯 好消息是…</c>


289
00:12:24,278 --> 00:12:25,812 line:90%,end
<c.magenta>…哦 就这样吧 它出来了</c>


290
00:12:26,446 --> 00:12:29,950 line:90%,end
<c.magenta>好了 让我们把这个命名为杂事</c>


291
00:12:30,150 --> 00:12:31,718 line:90%,end
<c.magenta>因为很遗憾 我不得不做这些杂事</c>


292
00:12:32,920 --> 00:12:36,023 line:90%,end
<c.magenta>好了 那么服务器上就保存了两个列表</c>


293
00:12:36,089 --> 00:12:38,025 line:90%,end
<c.magenta>因此在我们iOS应用中</c>
<c.magenta>就有了三个列表</c>


294
00:12:38,625 --> 00:12:40,227 line:90%,end
<c.magenta>现在让我们跳回到Dashboard</c>


295
00:12:40,360 --> 00:12:44,064 line:90%,end
<c.magenta>并获取自上次起</c>
<c.magenta>在本区内所发生的那些变更</c>


296
00:12:44,131 --> 00:12:45,299 line:90%,end
<c.magenta>上次它说没有任何变更</c>


297
00:12:47,467 --> 00:12:48,602 line:90%,end
<c.magenta>那么现在 当我获取变更时</c>


298
00:12:48,669 --> 00:12:51,471 line:90%,end
<c.magenta>我们可以看到我刚在应用中</c>
<c.magenta>创建的那两个列表记录</c>


299
00:12:52,406 --> 00:12:55,209 line:90%,end
<c.magenta>如果我轻触第二条记录的记录名称</c>


300
00:12:55,409 --> 00:12:57,744 line:90%,end
<c.magenta>它就会打开一个叫作</c>
<c.magenta>记录编辑器的东西</c>


301
00:12:58,278 --> 00:13:00,914 line:90%,end
<c.magenta>这会显示那条记录的相关信息</c>


302
00:13:01,248 --> 00:13:03,383 line:90%,end
<c.magenta>在本例中 我们可以看到</c>
<c.magenta>它的唯一记录名称</c>


303
00:13:03,951 --> 00:13:05,519 line:90%,end
<c.magenta>我们可以看到记录类型</c>


304
00:13:05,819 --> 00:13:07,487 line:90%,end
<c.magenta>在本例中是一个列表记录类型</c>


305
00:13:07,554 --> 00:13:09,890 line:90%,end
<c.magenta>就像我之前在谈到数据模型时</c>
<c.magenta>提到过的那样</c>


306
00:13:10,858 --> 00:13:13,694 line:90%,end
<c.magenta>这条记录是在我私密数据库中的计划区</c>


307
00:13:13,961 --> 00:13:16,330 line:90%,end
<c.magenta>我不久前才创建并修改了它</c>


308
00:13:17,464 --> 00:13:19,433 line:90%,end
<c.magenta>在下边 你可以看到我们</c>


309
00:13:19,600 --> 00:13:20,868 line:90%,end
<c.magenta>为这条记录所存储的字段</c>


310
00:13:20,934 --> 00:13:22,836 line:90%,end
<c.magenta>在本例中 我们用了名称字段</c>


311
00:13:22,936 --> 00:13:25,672 line:90%,end
<c.magenta>来存储用户在应用中提供的名称</c>


312
00:13:26,573 --> 00:13:28,942 line:90%,end
<c.magenta>我已经决定了 杂事这个名字</c>
<c.magenta>听起来不是很兴奋</c>


313
00:13:29,009 --> 00:13:31,578 line:90%,end
<c.magenta>所以让我们将其重新命名为</c>
<c.magenta>要观看的电影</c>


314
00:13:31,645 --> 00:13:32,946 line:90%,end
<c.magenta>并修改计划列表</c>


315
00:13:33,413 --> 00:13:35,816 line:90%,end
<c.magenta>现在我要把这个保存到</c>
<c.magenta>Dashboard的服务器视图中</c>


316
00:13:35,883 --> 00:13:38,619 line:90%,end
<c.magenta>并且我希望你能看着右侧的iOS应用</c>


317
00:13:39,920 --> 00:13:41,355 line:90%,end
<c.magenta>Dashboard发生了变化</c>


318
00:13:41,421 --> 00:13:43,857 line:90%,end
<c.magenta>将那条记录变更保存到了服务器上</c>


319
00:13:44,424 --> 00:13:47,694 line:90%,end
<c.magenta>服务器看到我对私密数据库</c>
<c.magenta>设置了一个订阅</c>


320
00:13:47,895 --> 00:13:50,030 line:90%,end
<c.magenta>然后就给我的设备</c>
<c.magenta>发送了一条推送通知</c>


321
00:13:50,497 --> 00:13:53,100 line:90%,end
<c.magenta>我的应用看到了那条推送 就反过来</c>


322
00:13:53,166 --> 00:13:56,670 line:90%,end
<c.magenta>获取到了新的变更</c>
<c.magenta>更新了它的本地核心数据缓存</c>


323
00:13:56,870 --> 00:13:58,906 line:90%,end
<c.magenta>并且现在你可以看到</c>
<c.magenta>UI反应了一个事实</c>


324
00:13:59,139 --> 00:14:01,475 line:90%,end
<c.magenta>即我们将那个列表名称</c>
<c.magenta>改为了要观看的电影</c>


325
00:14:03,143 --> 00:14:05,145 line:90%,end
<c.magenta>那么希望你们大家了解了</c>


326
00:14:05,212 --> 00:14:07,514 line:90%,end
<c.magenta>如何使用获取变更API</c>


327
00:14:08,382 --> 00:14:11,718 line:90%,end
<c.magenta>让我们跳回到幻灯片</c>
<c.magenta>并回顾一下我们刚才所讲的</c>


328
00:14:13,854 --> 00:14:15,088 line:90%,end
<c.magenta>在Dashboard中</c>


329
00:14:15,155 --> 00:14:16,557 line:90%,end
<c.magenta>当我们使用记录编辑器</c>


330
00:14:16,623 --> 00:14:19,193 line:90%,end
<c.magenta>来修改那条记录</c>
<c.magenta>以在服务器上更新它时</c>


331
00:14:19,826 --> 00:14:23,564 line:90%,end
<c.magenta>它使用了公共可用的</c>
<c.magenta>CloudKit Web Service API</c>


332
00:14:23,630 --> 00:14:24,831 line:90%,end
<c.magenta>你们大家都能用</c>


333
00:14:25,265 --> 00:14:28,769 line:90%,end
<c.magenta>它给记录修改终端</c>
<c.magenta>发送了一个HTTP post</c>


334
00:14:28,836 --> 00:14:30,337 line:90%,end
<c.magenta>然后发送了一个JSON body</c>


335
00:14:30,404 --> 00:14:32,072 line:90%,end
<c.magenta>说“我想更新这条记录 ”</c>


336
00:14:32,406 --> 00:14:34,675 line:90%,end
<c.magenta>并将其名称字段设为要观看的电影</c>


337
00:14:35,576 --> 00:14:38,979 line:90%,end
<c.magenta>那与iOS中的</c>
<c.magenta>CKModifyRecordsOperation相对应</c>


338
00:14:39,146 --> 00:14:41,014 line:90%,end
<c.magenta>原生API</c>


339
00:14:41,181 --> 00:14:43,817 line:90%,end
<c.magenta>就是我们在这里的示例iOS应用中</c>
<c.magenta>使用的那个</c>


340
00:14:45,319 --> 00:14:48,755 line:90%,end
<c.magenta>当我们在计划区内获取区变更时</c>


341
00:14:49,122 --> 00:14:51,892 line:90%,end
<c.magenta>使用了公共可用的记录变更终端</c>


342
00:14:52,226 --> 00:14:53,827 line:90%,end
<c.magenta>它说“服务器 请告诉我</c>


343
00:14:53,894 --> 00:14:57,097 line:90%,end
<c.magenta>在过去几天里 计划区中</c>
<c.magenta>发生变更的记录集合</c>


344
00:14:57,264 --> 00:14:58,665 line:90%,end
<c.magenta>自添加这个变更标记开始”</c>


345
00:14:59,266 --> 00:15:00,267 line:90%,end
<c.magenta>那个对应的是</c>


346
00:15:00,334 --> 00:15:03,070 line:90%,end
<c.magenta>原生API中的</c>
<c.magenta>CKFetchRecordZoneChangesOperation</c>


347
00:15:03,237 --> 00:15:05,539 line:90%,end
<c.magenta>就是我们在应用中所使用的那个</c>


348
00:15:06,206 --> 00:15:07,741 line:90%,end
<c.magenta>这里的重点是Dashboard</c>


349
00:15:07,808 --> 00:15:10,210 line:90%,end
<c.magenta>可以让你了解那个与</c>


350
00:15:10,344 --> 00:15:12,613 line:90%,end
<c.magenta>你在本地和网络应用中</c>
<c.magenta>所使用的那个相同的API</c>


351
00:15:12,913 --> 00:15:15,549 line:90%,end
<c.magenta>还允许你们了解和调试功能</c>


352
00:15:15,616 --> 00:15:17,384 line:90%,end
<c.magenta>当你们把这个API创建到你的应用中时</c>


353
00:15:20,120 --> 00:15:23,524 line:90%,end
<c.magenta>现在我提到过</c>
<c.magenta>同步全部数据的一个步骤是</c>


354
00:15:23,590 --> 00:15:25,993 line:90%,end
<c.magenta>订阅和推送通知</c>


355
00:15:26,760 --> 00:15:28,428 line:90%,end
<c.magenta>让我们跳回Dashboard</c>


356
00:15:28,495 --> 00:15:31,265 line:90%,end
<c.magenta>看看它是如何让我们来试验</c>


357
00:15:31,331 --> 00:15:33,233 line:90%,end
<c.magenta>和理解这个行为的更多信息</c>


358
00:15:34,001 --> 00:15:35,802 line:90%,end
<c.magenta>那么我要关掉记录编辑器</c>


359
00:15:35,869 --> 00:15:38,805 line:90%,end
<c.magenta>提醒一下</c>
<c.magenta>我们现在正处于开发环境的数据部分</c>


360
00:15:39,039 --> 00:15:41,208 line:90%,end
<c.magenta>这里有一个订阅的新标签</c>


361
00:15:42,009 --> 00:15:45,546 line:90%,end
<c.magenta>如果我点击这个标签</c>
<c.magenta>它会让我用CloudKit中的订阅API</c>


362
00:15:45,812 --> 00:15:49,550 line:90%,end
<c.magenta>来获取指定数据库内存在的订阅</c>


363
00:15:50,284 --> 00:15:52,386 line:90%,end
<c.magenta>那么我要请求有哪些订阅存在于</c>


364
00:15:52,452 --> 00:15:53,820 line:90%,end
<c.magenta>我的私密数据库中</c>


365
00:15:54,087 --> 00:15:56,456 line:90%,end
<c.magenta>我们可以看到我们的服务器</c>
<c.magenta>返回了一个结果</c>


366
00:15:56,723 --> 00:15:58,091 line:90%,end
<c.magenta>是一个数据库订阅</c>


367
00:15:58,158 --> 00:16:00,627 line:90%,end
<c.magenta>我已经给它提供了私密变更的ID</c>


368
00:16:00,694 --> 00:16:02,262 line:90%,end
<c.magenta>是我从我的代码中选择的</c>


369
00:16:02,629 --> 00:16:04,464 line:90%,end
<c.magenta>那么这就是一个存在的订阅</c>


370
00:16:04,565 --> 00:16:06,934 line:90%,end
<c.magenta>它会告诉服务器发送推送通知</c>


371
00:16:07,234 --> 00:16:08,902 line:90%,end
<c.magenta>无论何时当我的私密数据发生变更时</c>


372
00:16:10,237 --> 00:16:11,872 line:90%,end
<c.magenta>如果我请求的是共享数据库</c>


373
00:16:11,939 --> 00:16:14,208 line:90%,end
<c.magenta>我们也能在这里看到一个数据库订阅</c>


374
00:16:14,274 --> 00:16:16,710 line:90%,end
<c.magenta>就像我在ID共享变更那儿</c>
<c.magenta>提到过的一样</c>


375
00:16:18,245 --> 00:16:21,215 line:90%,end
<c.magenta>现在那儿有订阅和推送通知</c>


376
00:16:21,281 --> 00:16:22,416 line:90%,end
<c.magenta>而你正在获取变更</c>


377
00:16:22,482 --> 00:16:24,518 line:90%,end
<c.magenta>可能是在多台设备上进行的</c>


378
00:16:24,718 --> 00:16:26,086 line:90%,end
<c.magenta>这个很复杂</c>


379
00:16:26,186 --> 00:16:29,790 line:90%,end
<c.magenta>看到全部事件的日志</c>
<c.magenta>难道不觉得很棒吗？</c>


380
00:16:29,857 --> 00:16:31,658 line:90%,end
<c.magenta>当事件正在服务器上发生时</c>


381
00:16:31,925 --> 00:16:32,759 line:90%,end
<c.magenta>嗯 现在就是这样</c>


382
00:16:33,694 --> 00:16:35,495 line:90%,end
<c.magenta>如果我点击返回到容器</c>


383
00:16:36,029 --> 00:16:39,399 line:90%,end
<c.magenta>谢谢 那儿出现了一个新部分</c>
<c.magenta>叫作日志</c>


384
00:16:39,466 --> 00:16:41,702 line:90%,end
<c.magenta>我要在这个开发环境中点击进入</c>


385
00:16:42,503 --> 00:16:44,972 line:90%,end
<c.magenta>这就启动了一个叫作实时日志的功能</c>


386
00:16:45,439 --> 00:16:47,508 line:90%,end
<c.magenta>它打开了一个实时连接</c>


387
00:16:47,574 --> 00:16:49,042 line:90%,end
<c.magenta>连接CloudKit服务器</c>


388
00:16:49,476 --> 00:16:51,979 line:90%,end
<c.magenta>服务器将在事件发生时将这些事件</c>


389
00:16:52,045 --> 00:16:53,180 line:90%,end
<c.magenta>推送到你的浏览器上</c>


390
00:16:53,780 --> 00:16:55,048 line:90%,end
<c.magenta>它加载历史</c>


391
00:16:55,249 --> 00:16:58,018 line:90%,end
<c.magenta>所以在这里</c>
<c.magenta>我们可以看到我们从iOS</c>


392
00:16:58,085 --> 00:17:01,088 line:90%,end
<c.magenta>从这里的这个应用以及</c>
<c.magenta>从Web Service API中所提交的请求</c>


393
00:17:01,154 --> 00:17:03,290 line:90%,end
<c.magenta>因为那是CloudKit Dashboard所使用的</c>


394
00:17:03,657 --> 00:17:05,893 line:90%,end
<c.magenta>我们可以看到我们做了一些记录修改</c>


395
00:17:05,959 --> 00:17:07,361 line:90%,end
<c.magenta>一些区获取等等</c>


396
00:17:07,961 --> 00:17:10,564 line:90%,end
<c.magenta>现在 让我们清除一下</c>
<c.magenta>并创建一个新列表</c>


397
00:17:10,664 --> 00:17:12,266 line:90%,end
<c.magenta>看看日志中会发生什么</c>


398
00:17:13,133 --> 00:17:14,233 line:90%,end
<c.magenta>那么我要创建一个列表</c>


399
00:17:14,300 --> 00:17:16,703 line:90%,end
<c.magenta>然后我们看到事件弹出来了</c>
<c.magenta>或者说蹦出来了</c>


400
00:17:17,604 --> 00:17:20,174 line:90%,end
<c.magenta>那么在这里我们可以看到</c>
<c.magenta>关于该事件的相关信息</c>


401
00:17:20,874 --> 00:17:22,108 line:90%,end
<c.magenta>让我们跳回到幻灯片</c>


402
00:17:22,175 --> 00:17:23,710 line:90%,end
<c.magenta>谈谈你可能会在日志中</c>


403
00:17:23,777 --> 00:17:25,512 line:90%,end
<c.magenta>看到的所有东西</c>


404
00:17:25,579 --> 00:17:27,247 line:90%,end
<c.magenta>（在CloudKit Dashboard中</c>
<c.magenta>演示——订阅&推送）</c>


405
00:17:28,415 --> 00:17:29,816 line:90%,end
<c.magenta>那么这是一个示例行</c>


406
00:17:29,883 --> 00:17:31,652 line:90%,end
<c.magenta>就像我们刚才在用户界面中看到的那样</c>


407
00:17:31,752 --> 00:17:34,388 line:90%,end
<c.magenta>让我们具体到每一栏</c>
<c.magenta>看看都显示了什么东西</c>


408
00:17:35,355 --> 00:17:36,924 line:90%,end
<c.magenta>第一栏是时间</c>


409
00:17:37,090 --> 00:17:39,359 line:90%,end
<c.magenta>这个时间就是事件</c>
<c.magenta>在服务器上发生时的时间</c>


410
00:17:40,227 --> 00:17:41,762 line:10%
<c.magenta>下一栏是平台</c>


411
00:17:42,162 --> 00:17:44,831 line:10%
<c.magenta>这显示了请求来自哪个平台</c>


412
00:17:45,265 --> 00:17:49,570 line:10%
<c.magenta>因为iOS、macOS、tvOS</c>
<c.magenta>和watchOS中都能用CloudKit</c>


413
00:17:49,870 --> 00:17:51,338 line:10%
<c.magenta>你可能会在这里看到以上全部平台</c>


414
00:17:51,405 --> 00:17:53,340 line:10%
<c.magenta>如果你正在这些平台上创建应用的话</c>


415
00:17:53,841 --> 00:17:55,876 line:10%
<c.magenta>你还可以看到平台版本号</c>


416
00:17:56,276 --> 00:17:58,245 line:10%
<c.magenta>并且如果你正在用Web Service API</c>


417
00:17:58,378 --> 00:18:01,682 line:10%
<c.magenta>来创建一个网络应用</c>
<c.magenta>或将你的应用扩展到另一个平台上</c>


418
00:18:01,982 --> 00:18:03,417 line:10%
<c.magenta>你会看到它将在此显示网络</c>


419
00:18:05,185 --> 00:18:07,054 line:10%
<c.magenta>下一栏是用户</c>


420
00:18:07,454 --> 00:18:09,957 line:10%
<c.magenta>这将显示CloudKit用户记录ID</c>


421
00:18:10,591 --> 00:18:14,328 line:10%
<c.magenta>在本例中 如果发送此事件的人</c>


422
00:18:14,661 --> 00:18:17,931 line:10%
<c.magenta>在你的开发者团队中并且我们知道</c>
<c.magenta>他们的名字 那么将在这里显示出来</c>


423
00:18:18,398 --> 00:18:21,668 line:90%,end
<c.magenta>那么我们知道我的名字</c>
<c.magenta>因为我登录了我团队中的Dashboard</c>


424
00:18:21,802 --> 00:18:23,470 line:90%,end
<c.magenta>这非常便利 当你在开发时</c>


425
00:18:23,537 --> 00:18:25,472 line:90%,end
<c.magenta>与你们团队中的人进行测试时</c>


426
00:18:25,806 --> 00:18:27,741 line:90%,end
<c.magenta>但是对于其他人 对于你的普通用户</c>


427
00:18:27,808 --> 00:18:29,877 line:90%,end
<c.magenta>它会显示CloudKit用户记录ID</c>


428
00:18:31,278 --> 00:18:33,380 line:10%
<c.magenta>下一栏是事件类型</c>


429
00:18:33,747 --> 00:18:35,349 line:10%
<c.magenta>这是最常用的数据库</c>


430
00:18:35,415 --> 00:18:37,551 line:10%
<c.magenta>当你与数据库API交互时</c>


431
00:18:37,851 --> 00:18:39,653 line:10%
<c.magenta>但如果你有订阅</c>


432
00:18:39,820 --> 00:18:42,523 line:10%
<c.magenta>并且CloudKit以你的名义</c>
<c.magenta>发送推送通知</c>


433
00:18:42,723 --> 00:18:45,792 line:10%
<c.magenta>当推送发生时</c>
<c.magenta>你会在这个日志的这里看到那些推送</c>


434
00:18:46,493 --> 00:18:48,896 line:10%
<c.magenta>你还可以看到单独调用了共享事件</c>


435
00:18:50,430 --> 00:18:52,432 line:90%,end
<c.magenta>下一栏是操作ID</c>


436
00:18:52,900 --> 00:18:56,570 line:90%,end
<c.magenta>那么作为</c>
<c.magenta>iOS10.3 macOS Sierra的最新版本</c>


437
00:18:57,171 --> 00:18:59,339 line:90%,end
<c.magenta>CloudKit将自动创建唯一ID</c>


438
00:18:59,406 --> 00:19:02,409 line:90%,end
<c.magenta>给你在本地API中发起的每一个操作</c>


439
00:19:02,643 --> 00:19:04,011 line:90%,end
<c.magenta>并且你会在这里看到它们</c>


440
00:19:05,145 --> 00:19:07,414 line:90%,end
<c.magenta>下一栏是操作群名称</c>


441
00:19:07,648 --> 00:19:09,283 line:90%,end
<c.magenta>我们稍后再讲这个</c>


442
00:19:10,117 --> 00:19:12,452 line:90%,end
<c.magenta>最后一栏是详情</c>


443
00:19:12,519 --> 00:19:14,354 line:90%,end
<c.magenta>只是这个时间类型的详情</c>


444
00:19:14,855 --> 00:19:16,657 line:90%,end
<c.magenta>在本例中是一个数据库事件</c>


445
00:19:16,957 --> 00:19:19,226 line:10%
<c.magenta>所以我们可以看到我们发起的</c>


446
00:19:19,293 --> 00:19:20,827 line:10%
<c.magenta>返回到服务器的数据库操作的类型</c>


447
00:19:21,094 --> 00:19:22,563 line:10%
<c.magenta>这个是一个区获取</c>


448
00:19:22,696 --> 00:19:25,365 line:10%
<c.magenta>但你可以看到这样的东西</c>
<c.magenta>如记录修改、数据库变更</c>


449
00:19:25,432 --> 00:19:27,768 line:10%
<c.magenta>取决于你所提交的操作类型</c>


450
00:19:29,269 --> 00:19:31,104 line:90%,end
<c.magenta>在本例中 因为这是一个数据库操作</c>


451
00:19:31,171 --> 00:19:33,006 line:90%,end
<c.magenta>我们可以看到它是在私密数据库</c>


452
00:19:33,073 --> 00:19:34,408 line:10%
<c.magenta>和计划区中</c>


453
00:19:36,410 --> 00:19:38,278 line:90%,end
<c.magenta>我们还可以看到服务器延迟</c>


454
00:19:38,345 --> 00:19:41,582 line:90%,end
<c.magenta>现在 这是CloudKit服务器</c>
<c.magenta>处理这个所需要的时间</c>


455
00:19:41,715 --> 00:19:44,151 line:90%,end
<c.magenta>但请注意 这并不包含因特网延迟</c>


456
00:19:44,218 --> 00:19:47,688 line:90%,end
<c.magenta>或从客户端获取到服务器</c>
<c.magenta>再从服务器返回给客户端的时间</c>


457
00:19:49,323 --> 00:19:52,125 line:90%,end
<c.magenta>你可以看到请求大小和应答大小</c>


458
00:19:53,026 --> 00:19:54,862 line:90%,end
<c.magenta>你还可以看到硬件标识符</c>


459
00:19:54,928 --> 00:19:56,730 line:90%,end
<c.magenta>不 这并不是一台新型iPhone</c>


460
00:19:57,130 --> 00:19:59,833 line:90%,end
<c.magenta>这实际上是iPhone 6s Plus的标识符</c>


461
00:19:59,900 --> 00:20:01,001 line:90%,end
<c.magenta>就是我在这里运行的这个</c>


462
00:20:02,703 --> 00:20:04,571 line:90%,end
<c.magenta>一些关于操作群的更多信息</c>


463
00:20:04,638 --> 00:20:06,173 line:90%,end
<c.magenta>我们稍后会详细说明</c>


464
00:20:06,673 --> 00:20:08,208 line:10%
<c.magenta>最后 请求ID</c>


465
00:20:08,742 --> 00:20:09,910 line:10%
<c.magenta>这个很有意思</c>


466
00:20:10,110 --> 00:20:13,614 line:10%
<c.magenta>因为当你通过API发起操作时</c>


467
00:20:13,814 --> 00:20:16,216 line:10%
<c.magenta>那通常会映射到一个一对一请求</c>


468
00:20:16,850 --> 00:20:19,052 line:90%,end
<c.magenta>但有时候 客户端可能需要发起</c>


469
00:20:19,119 --> 00:20:21,722 line:90%,end
<c.magenta>多个网络请求来执行你的操作</c>


470
00:20:22,122 --> 00:20:24,358 line:90%,end
<c.magenta>如果是那种情况</c>
<c.magenta>你会看到日志中显示多个行</c>


471
00:20:24,424 --> 00:20:27,027 line:90%,end
<c.magenta>但其操作ID都一样</c>


472
00:20:27,160 --> 00:20:29,830 line:90%,end
<c.magenta>但请求ID不同 从而帮助你进行区分</c>


473
00:20:31,865 --> 00:20:33,400 line:90%,end
<c.magenta>如果一个事件导致了一个报错</c>


474
00:20:33,467 --> 00:20:34,902 line:90%,end
<c.magenta>你会看到它会显示成红色的</c>


475
00:20:35,102 --> 00:20:37,070 line:90%,end
<c.magenta>它也会给出具体的报错类型</c>


476
00:20:37,471 --> 00:20:40,240 line:90%,end
<c.magenta>在本例中</c>
<c.magenta>我尝试获取一个并不存在的区</c>


477
00:20:40,440 --> 00:20:42,643 line:90%,end
<c.magenta>所以服务器说没有找到该区</c>


478
00:20:44,511 --> 00:20:46,847 line:90%,end
<c.magenta>好了 那么我好几次都提到了操作群</c>


479
00:20:46,947 --> 00:20:47,814 line:90%,end
<c.magenta>那什么是操作群呢？</c>


480
00:20:48,515 --> 00:20:51,885 line:90%,end
<c.magenta>嗯 是iOS 11和与之匹配的</c>
<c.magenta>其它平台中的新功能</c>


481
00:20:52,186 --> 00:20:54,421 line:90%,end
<c.magenta>我们提供了 你很可能猜到了</c>


482
00:20:54,655 --> 00:20:59,459 line:90%,end
<c.magenta>我们基于应用逻辑提供了群操作</c>


483
00:21:00,027 --> 00:21:01,195 line:90%,end
<c.magenta>那么让我们看一个例子</c>


484
00:21:01,995 --> 00:21:03,564 line:90%,end
<c.magenta>在这个计划列表应用中</c>


485
00:21:03,664 --> 00:21:05,832 line:90%,end
<c.magenta>当它首次启动时需要完成一系列操作</c>


486
00:21:05,899 --> 00:21:09,036 line:90%,end
<c.magenta>在初始化逻辑中</c>


487
00:21:09,703 --> 00:21:11,738 line:90%,end
<c.magenta>它需要在服务器上创建一个区</c>


488
00:21:11,805 --> 00:21:13,473 line:90%,end
<c.magenta>并在这个区内存储我们的记录</c>


489
00:21:13,974 --> 00:21:15,809 line:90%,end
<c.magenta>它需要创建两个订阅</c>


490
00:21:15,876 --> 00:21:17,511 line:90%,end
<c.magenta>请记住 我提到过数据库订阅</c>


491
00:21:17,578 --> 00:21:19,112 line:90%,end
<c.magenta>在私密数据库和共享数据库中</c>


492
00:21:20,280 --> 00:21:22,716 line:90%,end
<c.magenta>并且它需要获取全部现有的变更</c>


493
00:21:22,783 --> 00:21:24,418 line:90%,end
<c.magenta>私密数据库和共享数据库中的</c>


494
00:21:24,484 --> 00:21:26,320 line:90%,end
<c.magenta>然后可能还要获取区变更</c>


495
00:21:26,587 --> 00:21:28,322 line:90%,end
<c.magenta>那么有一系列的操作</c>


496
00:21:28,622 --> 00:21:31,291 line:90%,end
<c.magenta>全部操作都围绕着初始化逻辑</c>


497
00:21:31,458 --> 00:21:34,261 line:90%,end
<c.magenta>所以我们现在有一种可以</c>
<c.magenta>将那个逻辑聚合在一起的方式</c>


498
00:21:35,696 --> 00:21:36,630 line:90%,end
<c.magenta>现在 你很可能知道</c>


499
00:21:36,697 --> 00:21:40,000 line:90%,end
<c.magenta>有许多Apple应用</c>
<c.magenta>是建在CloudKit上</c>


500
00:21:40,200 --> 00:21:41,602 line:90%,end
<c.magenta>我希望给大家看一些例子</c>


501
00:21:41,668 --> 00:21:45,105 line:90%,end
<c.magenta>看我们是如何</c>
<c.magenta>在应用中使用操作群名称的</c>


502
00:21:46,139 --> 00:21:48,675 line:90%,end
<c.magenta>iCloud Backup是建在CloudKit上</c>


503
00:21:49,276 --> 00:21:52,613 line:90%,end
<c.magenta>所以每天晚上 当你的iPhone或iPad</c>
<c.magenta>充电时且Wi-Fi可用时</c>


504
00:21:52,679 --> 00:21:54,281 line:90%,end
<c.magenta>它就会自动备份它自己</c>


505
00:21:54,748 --> 00:21:57,684 line:90%,end
<c.magenta>那可能需要一系列的</c>
<c.magenta>CloudKit操作来实现</c>


506
00:21:57,918 --> 00:21:59,286 line:90%,end
<c.magenta>所以我们可将这些操作聚合在</c>


507
00:21:59,353 --> 00:22:01,955 line:90%,end
<c.magenta>一个叫作自动备份的操作群中</c>


508
00:22:02,656 --> 00:22:04,258 line:90%,end
<c.magenta>如果用户手动触发了一个操作</c>


509
00:22:04,324 --> 00:22:06,693 line:90%,end
<c.magenta>我们可以把那个单独调出来</c>
<c.magenta>作为手动备份</c>


510
00:22:07,094 --> 00:22:09,563 line:90%,end
<c.magenta>当他们在新设备上恢复数据时</c>


511
00:22:09,630 --> 00:22:10,898 line:90%,end
<c.magenta>我们可以有一个操作群</c>


512
00:22:10,964 --> 00:22:13,267 line:90%,end
<c.magenta>里面包含全部操作</c>


513
00:22:14,168 --> 00:22:16,870 line:90%,end
<c.magenta>iCloud Photo Library</c>
<c.magenta>是建在CloudKit上</c>


514
00:22:17,070 --> 00:22:19,006 line:90%,end
<c.magenta>并且它用操作群来指定</c>


515
00:22:19,072 --> 00:22:20,541 line:90%,end
<c.magenta>何时设置你的图库</c>


516
00:22:20,607 --> 00:22:23,644 line:90%,end
<c.magenta>下载缩略图或获取你轻触的电影</c>


517
00:22:24,578 --> 00:22:28,315 line:90%,end
<c.magenta>iCloud Drive是建在CloudKit上</c>
<c.magenta>那么它的操作群</c>


518
00:22:28,482 --> 00:22:30,450 line:90%,end
<c.magenta>会在当首次从服务器上</c>


519
00:22:30,517 --> 00:22:31,885 line:90%,end
<c.magenta>拉动任何变更时调用</c>


520
00:22:32,052 --> 00:22:34,721 line:90%,end
<c.magenta>由于有订阅</c>
<c.magenta>所以会在推送之后拉动变更</c>


521
00:22:35,389 --> 00:22:37,224 line:90%,end
<c.magenta>或当你轻触进入一个文件</c>
<c.magenta>以下载它时调用</c>


522
00:22:39,026 --> 00:22:40,360 line:90%,end
<c.magenta>让我们看一下API</c>


523
00:22:40,861 --> 00:22:41,929 line:90%,end
<c.magenta>那么有一个新类</c>


524
00:22:41,995 --> 00:22:43,363 line:90%,end
<c.magenta>CKOperationGroup</c>


525
00:22:44,331 --> 00:22:47,801 line:90%,end
<c.magenta>它给你提供了</c>
<c.magenta>由系统分配的操作群ID集合</c>


526
00:22:48,569 --> 00:22:52,272 line:90%,end
<c.magenta>它允许你指定一个</c>
<c.magenta>CKOperationConfiguration</c>


527
00:22:52,472 --> 00:22:53,874 line:90%,end
<c.magenta>我们稍后会谈到这个</c>


528
00:22:54,141 --> 00:22:56,844 line:90%,end
<c.magenta>它允许你提供一个名称</c>


529
00:22:57,010 --> 00:22:59,613 line:90%,end
<c.magenta>这是你的应用所支持的任意字符串</c>


530
00:22:59,813 --> 00:23:02,316 line:90%,end
<c.magenta>刚才幻灯片上的名称</c>
<c.magenta>就是我们要使用的名称</c>


531
00:23:02,716 --> 00:23:04,117 line:90%,end
<c.magenta>我们希望能小心一些</c>


532
00:23:04,184 --> 00:23:06,553 line:90%,end
<c.magenta>不要在这里放可识别身份的私人信息</c>


533
00:23:06,620 --> 00:23:08,689 line:90%,end
<c.magenta>这是你的应用逻辑</c>
<c.magenta>表明它正在做什么</c>


534
00:23:10,424 --> 00:23:12,226 line:90%,end
<c.magenta>下一个属性是数量</c>


535
00:23:12,693 --> 00:23:14,394 line:90%,end
<c.magenta>这是一个你可以设置的整数</c>


536
00:23:14,561 --> 00:23:16,597 line:90%,end
<c.magenta>它完全取决于你的应用</c>


537
00:23:17,064 --> 00:23:19,499 line:90%,end
<c.magenta>那么请看我们的应用中的一个例子</c>


538
00:23:19,900 --> 00:23:22,336 line:90%,end
<c.magenta>当我们在iCloud Backup中备份时</c>


539
00:23:22,603 --> 00:23:24,771 line:90%,end
<c.magenta>我们可能会指明</c>
<c.magenta>我们正在备份多少个文件</c>


540
00:23:25,772 --> 00:23:27,107 line:90%,end
<c.magenta>或在iCloud Photo Library中</c>


541
00:23:27,174 --> 00:23:29,243 line:90%,end
<c.magenta>当下载缩略图时 我们可以表明</c>


542
00:23:29,309 --> 00:23:31,612 line:90%,end
<c.magenta>在这个群中正在下载多少个缩略图</c>


543
00:23:31,879 --> 00:23:34,014 line:90%,end
<c.magenta>但是 重点是它完全取决于你的应用</c>


544
00:23:36,216 --> 00:23:39,620 line:90%,end
<c.magenta>你还可以设置预期的发送和接收大小</c>


545
00:23:40,254 --> 00:23:41,655 line:90%,end
<c.magenta>这将会告诉服务器 抱歉</c>


546
00:23:41,722 --> 00:23:43,524 line:90%,end
<c.magenta>告诉客户端</c>


547
00:23:43,657 --> 00:23:45,559 line:90%,end
<c.magenta>你认为你预计会有多少数据</c>


548
00:23:45,626 --> 00:23:47,494 line:90%,end
<c.magenta>正在你和服务器之间传送</c>


549
00:23:47,928 --> 00:23:48,962 line:90%,end
<c.magenta>请注意类型</c>


550
00:23:49,029 --> 00:23:51,565 line:90%,end
<c.magenta>是CKOperationGroupTransferSize</c>


551
00:23:52,065 --> 00:23:55,068 line:90%,end
<c.magenta>这是一个枚举 可以让你指定</c>


552
00:23:55,235 --> 00:23:56,470 line:90%,end
<c.magenta>数量级</c>


553
00:23:56,803 --> 00:23:59,006 line:90%,end
<c.magenta>那么重点是它是一个预估的数量级</c>


554
00:23:59,139 --> 00:24:01,308 line:90%,end
<c.magenta>不必是一个非常准确的字节字数</c>


555
00:24:01,875 --> 00:24:04,144 line:90%,end
<c.magenta>通过设置像这些属性一样的东西</c>


556
00:24:04,211 --> 00:24:06,446 line:90%,end
<c.magenta>以及像服务质量这样的属性</c>


557
00:24:06,713 --> 00:24:09,750 line:90%,end
<c.magenta>就允许系统进行优化 当网络调用</c>


558
00:24:09,816 --> 00:24:11,018 line:90%,end
<c.magenta>被返回给服务器时</c>


559
00:24:11,351 --> 00:24:14,121 line:90%,end
<c.magenta>基于你用户设备的网络情况</c>


560
00:24:16,356 --> 00:24:18,959 line:90%,end
<c.magenta>最后 一旦你配置好一个操作群</c>


561
00:24:19,193 --> 00:24:21,028 line:90%,end
<c.magenta>你可以向群里添加操作</c>


562
00:24:21,295 --> 00:24:23,163 line:90%,end
<c.magenta>通过将它应用到其群属性中</c>


563
00:24:23,997 --> 00:24:26,567 line:90%,end
<c.magenta>现在 我提到了</c>
<c.magenta>CKOperationConfiguration</c>


564
00:24:26,733 --> 00:24:28,268 line:90%,end
<c.magenta>我们稍后再讲这个</c>


565
00:24:29,236 --> 00:24:31,638 line:90%,end
<c.magenta>以前 你们经常定义属性 比如</c>


566
00:24:31,705 --> 00:24:34,041 line:90%,end
<c.magenta>操作上的qualityOfService、</c>
<c.magenta>allowsCellularAccess、</c>


567
00:24:34,241 --> 00:24:36,443 line:90%,end
<c.magenta>isLongLived</c>


568
00:24:37,177 --> 00:24:38,378 line:90%,end
<c.magenta>现在我们不用这个了</c>


569
00:24:38,745 --> 00:24:42,249 line:90%,end
<c.magenta>现在你可以把它应用到</c>
<c.magenta>CKOperationConfiguration中</c>


570
00:24:43,050 --> 00:24:44,117 line:90%,end
<c.magenta>原因是</c>


571
00:24:44,184 --> 00:24:45,819 line:90%,end
<c.magenta>因为我们发现很容易</c>


572
00:24:45,886 --> 00:24:47,421 line:90%,end
<c.magenta>忘记把这些应用到</c>


573
00:24:47,487 --> 00:24:49,857 line:90%,end
<c.magenta>你正在发起客户端中的全部操作上</c>


574
00:24:50,357 --> 00:24:53,527 line:90%,end
<c.magenta>那么现在</c>
<c.magenta>你可能只需要设置一次或几次</c>


575
00:24:54,061 --> 00:24:56,296 line:90%,end
<c.magenta>你可以将其特别应用到一个操作中</c>


576
00:24:56,363 --> 00:24:59,499 line:90%,end
<c.magenta>如果有意义的话 或者更有可能</c>


577
00:24:59,733 --> 00:25:01,268 line:90%,end
<c.magenta>应用到整个操作群中</c>


578
00:25:01,502 --> 00:25:03,871 line:90%,end
<c.magenta>那将会把它应用到</c>
<c.magenta>那个操作群内的全部操作中</c>


579
00:25:04,071 --> 00:25:06,073 line:90%,end
<c.magenta>这是那个我们以前见过的</c>


580
00:25:06,139 --> 00:25:07,908 line:90%,end
<c.magenta>操作群中的默认配置属性</c>


581
00:25:10,511 --> 00:25:13,480 line:90%,end
<c.magenta>好的 那么如果你回过头去</c>
<c.magenta>看之前的那个日志事件示例</c>


582
00:25:13,614 --> 00:25:17,050 line:90%,end
<c.magenta>让我们调一些与操作群有关的东西</c>


583
00:25:17,451 --> 00:25:20,387 line:90%,end
<c.magenta>那么在这里 你可以看到</c>
<c.magenta>在日志中有操作群名称</c>


584
00:25:20,754 --> 00:25:22,189 line:90%,end
<c.magenta>所以我可以看到发生了这个事件</c>


585
00:25:22,256 --> 00:25:25,158 line:90%,end
<c.magenta>归功于我应用的初始化逻辑</c>


586
00:25:25,759 --> 00:25:28,195 line:90%,end
<c.magenta>你还可以看到其唯一操作群ID</c>


587
00:25:28,395 --> 00:25:30,330 line:90%,end
<c.magenta>以及数量属性 如果你设置了的话</c>


588
00:25:31,398 --> 00:25:32,366 line:90%,end
<c.magenta>现在 在每个事件中</c>


589
00:25:32,432 --> 00:25:35,135 line:90%,end
<c.magenta>你都能看到它所应用的操作群</c>


590
00:25:35,502 --> 00:25:38,472 line:90%,end
<c.magenta>然后你可以看到所应用的具体操作</c>


591
00:25:38,639 --> 00:25:40,073 line:90%,end
<c.magenta>基于操作ID</c>


592
00:25:40,474 --> 00:25:42,176 line:90%,end
<c.magenta>并且如果它导致了多个请求</c>


593
00:25:42,242 --> 00:25:44,411 line:90%,end
<c.magenta>你还可以看到具体的请求ID</c>


594
00:25:46,346 --> 00:25:47,347 line:90%,end
<c.magenta>（隐私权）</c>


595
00:25:47,514 --> 00:25:49,383 line:90%,end
<c.magenta>好了 那么通过这个新的日志功能</c>


596
00:25:49,449 --> 00:25:50,851 line:90%,end
<c.magenta>我们能看到很多东西</c>


597
00:25:50,918 --> 00:25:52,986 line:90%,end
<c.magenta>让我们花点儿时间来谈谈隐私权</c>


598
00:25:53,554 --> 00:25:56,757 line:90%,end
<c.magenta>因为你知道的</c>
<c.magenta>Apple非常重视我们用户的隐私权</c>


599
00:25:57,558 --> 00:25:59,726 line:90%,end
<c.magenta>但对于CloudKit 我们理解</c>


600
00:25:59,793 --> 00:26:01,828 line:90%,end
<c.magenta>你是与一个团队一起合作</c>
<c.magenta>你并不是所有者</c>


601
00:26:01,895 --> 00:26:03,363 line:90%,end
<c.magenta>或者没有完全的权限</c>


602
00:26:03,630 --> 00:26:06,233 line:90%,end
<c.magenta>但是你仍然需要</c>
<c.magenta>调试客户端所发生的问题</c>


603
00:26:06,900 --> 00:26:09,536 line:90%,end
<c.magenta>那么考虑到这些情况</c>
<c.magenta>我们是这样解决的</c>


604
00:26:10,137 --> 00:26:11,205 line:90%,end
<c.magenta>提示一下</c>


605
00:26:11,338 --> 00:26:14,274 line:90%,end
<c.magenta>当你用你的iCloud账户</c>
<c.magenta>登录到CloudKit Dashboard时</c>


606
00:26:14,641 --> 00:26:16,677 line:90%,end
<c.magenta>你可以看到</c>
<c.magenta>你的私人数据和共享数据</c>


607
00:26:16,743 --> 00:26:19,546 line:90%,end
<c.magenta>在你的私密数据库和共享数据库中</c>
<c.magenta>就像我刚刚所展示的那样</c>


608
00:26:19,947 --> 00:26:22,850 line:90%,end
<c.magenta>但是你不能看到</c>
<c.magenta>其他用户的私人数据和共享数据</c>


609
00:26:23,951 --> 00:26:26,386 line:90%,end
<c.magenta>你可以看到公共数据库中的公共数据</c>


610
00:26:26,453 --> 00:26:27,855 line:90%,end
<c.magenta>因为那是发布给公众看的</c>


611
00:26:28,755 --> 00:26:32,392 line:90%,end
<c.magenta>你现在可以看到你自己</c>
<c.magenta>和其他用户的日志事件</c>


612
00:26:32,626 --> 00:26:35,996 line:90%,end
<c.magenta>然而 日志事件不包含数据</c>


613
00:26:36,663 --> 00:26:37,831 line:90%,end
<c.magenta>所以 比如</c>


614
00:26:37,965 --> 00:26:39,233 line:90%,end
<c.magenta>我们在这个</c>


615
00:26:39,299 --> 00:26:40,868 line:90%,end
<c.magenta>计划列表应用示例中所能看到的事件</c>


616
00:26:41,134 --> 00:26:42,369 line:90%,end
<c.magenta>你可以看到我的账户</c>


617
00:26:42,436 --> 00:26:44,338 line:90%,end
<c.magenta>正在发起记录修改</c>


618
00:26:44,838 --> 00:26:48,408 line:90%,end
<c.magenta>但你不能看到我正在创建一个</c>
<c.magenta>名称为假期点子</c>


619
00:26:48,575 --> 00:26:50,444 line:90%,end
<c.magenta>或杂事或要观看的电影的列表</c>


620
00:26:51,111 --> 00:26:52,779 line:90%,end
<c.magenta>我们希望这种平衡</c>
<c.magenta>可以真正允许你</c>


621
00:26:52,846 --> 00:26:54,648 line:90%,end
<c.magenta>在问题发生时进行调试</c>


622
00:26:54,815 --> 00:26:57,317 line:90%,end
<c.magenta>而仍然保证你客户数据的</c>
<c.magenta>安全性和隐私权</c>


623
00:26:59,119 --> 00:27:00,554 line:90%,end
<c.magenta>好的 那么我之前提到过</c>


624
00:27:00,621 --> 00:27:04,825 line:90%,end
<c.magenta>我们想在这个示例应用中</c>
<c.magenta>添加共享功能</c>


625
00:27:05,425 --> 00:27:09,229 line:90%,end
<c.magenta>我们想让用户安全地</c>
<c.magenta>与其他用户共享计划列表</c>


626
00:27:09,296 --> 00:27:10,631 line:90%,end
<c.magenta>以便他们可以共同合作</c>


627
00:27:11,365 --> 00:27:13,233 line:90%,end
<c.magenta>提醒一下 这是我们的数据模型</c>


628
00:27:13,634 --> 00:27:16,236 line:90%,end
<c.magenta>我们通过parent引用把东西指回列表</c>


629
00:27:16,537 --> 00:27:18,739 line:90%,end
<c.magenta>并且我们将那个列表</c>
<c.magenta>作为共享中的根记录</c>


630
00:27:20,007 --> 00:27:21,742 line:90%,end
<c.magenta>现在我们增加了一些功能</c>


631
00:27:22,209 --> 00:27:25,279 line:90%,end
<c.magenta>以在CloudKit Dashboard中</c>
<c.magenta>调试和探索这个</c>


632
00:27:25,612 --> 00:27:28,415 line:90%,end
<c.magenta>让我们看一眼</c>


633
00:27:29,316 --> 00:27:30,717 line:90%,end
<c.magenta>现在 在屏幕右侧</c>


634
00:27:30,784 --> 00:27:32,085 line:90%,end
<c.magenta>我想让你们看iOS应用</c>


635
00:27:32,186 --> 00:27:35,255 line:90%,end
<c.magenta>我要轻触</c>
<c.magenta>进入顶部的假期点子列表记录</c>


636
00:27:35,822 --> 00:27:37,824 line:90%,end
<c.magenta>你会注意到 它显示了一些信息</c>


637
00:27:37,891 --> 00:27:39,560 line:90%,end
<c.magenta>说这已经被共享了</c>


638
00:27:40,027 --> 00:27:43,497 line:90%,end
<c.magenta>那么具体情况是我在我的手机上</c>
<c.magenta>创建了这个计划列表</c>


639
00:27:43,664 --> 00:27:46,300 line:90%,end
<c.magenta>这也意味着它在我的私密数据库中</c>
<c.magenta>所以我是所有者</c>


640
00:27:46,867 --> 00:27:49,970 line:90%,end
<c.magenta>但我邀请了我的朋友</c>
<c.magenta>艾米丽·帕克来分享这个列表</c>


641
00:27:50,137 --> 00:27:51,405 line:90%,end
<c.magenta>因为她是一个旅行专家</c>


642
00:27:51,471 --> 00:27:54,174 line:90%,end
<c.magenta>并且我想让她给我一些</c>
<c.magenta>去哪儿度假的建议</c>


643
00:27:56,743 --> 00:28:00,113 line:90%,end
<c.magenta>那么在Dashboard中</c>
<c.magenta>如果我们返回到数据部分</c>


644
00:28:00,514 --> 00:28:02,983 line:90%,end
<c.magenta>请记住 上一次我们查看记录</c>


645
00:28:03,050 --> 00:28:05,519 line:90%,end
<c.magenta>是在我的私密数据库中的计划区</c>


646
00:28:07,421 --> 00:28:08,722 line:90%,end
<c.magenta>现在如果我们获取变更</c>


647
00:28:08,889 --> 00:28:10,791 line:90%,end
<c.magenta>直到我们明确</c>
<c.magenta>并没有什么东西发生了变更</c>


648
00:28:10,858 --> 00:28:12,559 line:90%,end
<c.magenta>所以Dashboard是最新的</c>


649
00:28:12,626 --> 00:28:15,229 line:90%,end
<c.magenta>让我们在iOS应用中添加一项</c>


650
00:28:16,196 --> 00:28:18,866 line:90%,end
<c.magenta>那么假如说我要去巴黎</c>


651
00:28:20,000 --> 00:28:23,604 line:90%,end
<c.magenta>那么我的iOS应用已经将那条记录</c>
<c.magenta>存储为一个Item并传回给服务器</c>


652
00:28:24,204 --> 00:28:26,273 line:90%,end
<c.magenta>若我再次从Dashboard</c>
<c.magenta>获取变更</c>


653
00:28:26,406 --> 00:28:27,374 line:90%,end
<c.magenta>我们看到有显示结果了</c>


654
00:28:28,275 --> 00:28:29,877 line:90%,end
<c.magenta>我要轻触记录名称</c>


655
00:28:29,977 --> 00:28:31,445 line:90%,end
<c.magenta>并打开记录编辑器</c>


656
00:28:31,778 --> 00:28:34,214 line:90%,end
<c.magenta>再一次 我们可以看到</c>
<c.magenta>这是Item的记录类型</c>


657
00:28:34,414 --> 00:28:37,184 line:90%,end
<c.magenta>它在我的私密数据库的计划区中</c>


658
00:28:37,784 --> 00:28:40,153 line:90%,end
<c.magenta>就在字段部分下边</c>
<c.magenta>我们可以看到巴黎</c>


659
00:28:40,220 --> 00:28:41,955 line:90%,end
<c.magenta>就是我刚在iOS应用中</c>
<c.magenta>提供的那个名称</c>


660
00:28:42,856 --> 00:28:43,824 line:90%,end
<c.magenta>现在 如果我稍微放大一点儿</c>


661
00:28:43,891 --> 00:28:46,093 line:90%,end
<c.magenta>你会注意到这里有一个部分</c>
<c.magenta>标签是共享</c>


662
00:28:46,493 --> 00:28:48,762 line:90%,end
<c.magenta>表明这条记录是一个后代</c>


663
00:28:49,196 --> 00:28:52,833 line:90%,end
<c.magenta>意思是它通过其parent引用</c>
<c.magenta>指向一个parent</c>


664
00:28:53,400 --> 00:28:55,869 line:90%,end
<c.magenta>Dashboard表明了</c>
<c.magenta>那个parent的记录名称</c>


665
00:28:56,136 --> 00:28:58,071 line:90%,end
<c.magenta>并提供了一个小的跳转图标</c>


666
00:28:58,138 --> 00:29:00,507 line:90%,end
<c.magenta>以在记录编辑器内</c>
<c.magenta>加载那个parent</c>


667
00:29:01,008 --> 00:29:01,875 line:90%,end
<c.magenta>那么 让我们具体看一下</c>


668
00:29:02,609 --> 00:29:04,778 line:90%,end
<c.magenta>那么现在 我们正在看一个列表记录</c>


669
00:29:05,245 --> 00:29:07,714 line:90%,end
<c.magenta>这是假期点子列表记录</c>


670
00:29:07,814 --> 00:29:09,650 line:90%,end
<c.magenta>在这条记录内</c>
<c.magenta>我们创建了巴黎这个列表项</c>


671
00:29:10,717 --> 00:29:14,221 line:90%,end
<c.magenta>在共享部分 我们可以看到</c>
<c.magenta>这是共享中的一个根记录</c>


672
00:29:14,855 --> 00:29:16,690 line:90%,end
<c.magenta>它指向一个具体的共享</c>


673
00:29:16,890 --> 00:29:18,292 line:90%,end
<c.magenta>它显示了共享名称</c>


674
00:29:18,358 --> 00:29:19,726 line:90%,end
<c.magenta>我们可以打开那个共享</c>


675
00:29:20,928 --> 00:29:23,864 line:90%,end
<c.magenta>那么现在</c>
<c.magenta>我们正在看一个CloudKit.share记录</c>


676
00:29:25,933 --> 00:29:27,601 line:90%,end
<c.magenta>在它下边 你可以在共享上看到</c>


677
00:29:27,668 --> 00:29:30,404 line:90%,end
<c.magenta>你可以看到关于参与共享的人的信息</c>


678
00:29:30,637 --> 00:29:32,606 line:90%,end
<c.magenta>那么在本例中</c>
<c.magenta>你可以看到我是所有者</c>


679
00:29:32,773 --> 00:29:34,474 line:90%,end
<c.magenta>而艾米丽接受了我的共享</c>


680
00:29:35,142 --> 00:29:37,377 line:90%,end
<c.magenta>你可以在这里添加和移除被共享者</c>


681
00:29:37,444 --> 00:29:39,513 line:90%,end
<c.magenta>以测试你应用的性能</c>


682
00:29:39,580 --> 00:29:41,515 line:90%,end
<c.magenta>当在服务器上修改被共享者的数据时</c>


683
00:29:41,715 --> 00:29:43,617 line:90%,end
<c.magenta>这就允许你浏览关系</c>


684
00:29:43,684 --> 00:29:45,085 line:90%,end
<c.magenta>如果记录编辑器检测到</c>


685
00:29:45,152 --> 00:29:47,955 line:90%,end
<c.magenta>在你的记录中有其它类型的引用</c>


686
00:29:48,121 --> 00:29:49,556 line:90%,end
<c.magenta>它会让你跳转过去</c>


687
00:29:49,890 --> 00:29:51,692 line:90%,end
<c.magenta>左上角这里有一个</c>


688
00:29:51,758 --> 00:29:52,793 line:90%,end
<c.magenta>前进和后退历史按钮</c>


689
00:29:53,760 --> 00:29:55,996 line:90%,end
<c.magenta>那表明了你如何浏览</c>


690
00:29:56,096 --> 00:29:58,298 line:90%,end
<c.magenta>和导航数据关系</c>


691
00:29:58,432 --> 00:29:59,733 line:90%,end
<c.magenta>在共享中</c>


692
00:30:00,667 --> 00:30:03,470 line:90%,end
<c.magenta>让我们看一下</c>
<c.magenta>日志如何为你提供帮助</c>


693
00:30:03,737 --> 00:30:05,873 line:90%,end
<c.magenta>当你正在应用中添加共享功能时</c>


694
00:30:06,473 --> 00:30:09,076 line:90%,end
<c.magenta>那么我要加载日志 让我们清除一下</c>


695
00:30:09,409 --> 00:30:12,346 line:90%,end
<c.magenta>让我们在我的iOS应用中</c>
<c.magenta>创建另一个列表项</c>


696
00:30:13,313 --> 00:30:16,450 line:90%,end
<c.magenta>那么比如说</c>
<c.magenta>我还想去奥地利的维也纳</c>


697
00:30:16,717 --> 00:30:17,851 line:90%,end
<c.magenta>现在我要点击返回</c>


698
00:30:17,918 --> 00:30:20,020 line:90%,end
<c.magenta>我想让你看一下</c>
<c.magenta>Dashboard上的日志</c>


699
00:30:20,754 --> 00:30:24,525 line:90%,end
<c.magenta>那么首先 我们看到进来了一个</c>
<c.magenta>关于记录修改的请求</c>


700
00:30:25,425 --> 00:30:27,928 line:90%,end
<c.magenta>我们可以看到</c>
<c.magenta>请注意我的操作群名称</c>


701
00:30:28,161 --> 00:30:29,029 line:90%,end
<c.magenta>我用了一个说明</c>


702
00:30:29,096 --> 00:30:32,332 line:90%,end
<c.magenta>“哦 这是在应用内创建列表项的逻辑</c>


703
00:30:32,866 --> 00:30:35,836 line:90%,end
<c.magenta>它是戴夫</c>
<c.magenta>私密数据库中的一个记录修改 ”</c>


704
00:30:36,570 --> 00:30:38,338 line:90%,end
<c.magenta>之后 我们可以随后看到</c>


705
00:30:38,405 --> 00:30:41,475 line:90%,end
<c.magenta>CloudKit给艾米丽</c>
<c.magenta>发送了一个推送通知</c>


706
00:30:42,342 --> 00:30:43,877 line:90%,end
<c.magenta>它在她的共享数据库中</c>


707
00:30:44,011 --> 00:30:45,546 line:90%,end
<c.magenta>这是由于一个叫作共享变更的订阅</c>


708
00:30:45,612 --> 00:30:47,648 line:90%,end
<c.magenta>是我们在她的设备上设置的</c>


709
00:30:47,714 --> 00:30:48,982 line:90%,end
<c.magenta>当她首次运行这个应用时</c>


710
00:30:50,250 --> 00:30:52,853 line:90%,end
<c.magenta>推送信息发送到了艾米丽的设备上</c>


711
00:30:53,086 --> 00:30:54,721 line:90%,end
<c.magenta>然后她的应用就返回来</c>


712
00:30:54,788 --> 00:30:56,490 line:90%,end
<c.magenta>获取数据库变更</c>


713
00:30:56,557 --> 00:30:57,958 line:90%,end
<c.magenta>然后是区变更</c>


714
00:30:58,158 --> 00:30:59,760 line:90%,end
<c.magenta>请注意操作群名称</c>


715
00:30:59,893 --> 00:31:01,929 line:90%,end
<c.magenta>在收到通知后获取变更</c>


716
00:31:03,197 --> 00:31:04,631 line:90%,end
<c.magenta>那么我们非常希望</c>
<c.magenta>这可以给你提供一些帮助</c>


717
00:31:04,698 --> 00:31:06,600 line:90%,end
<c.magenta>当你正在调试和尝试了解</c>


718
00:31:06,667 --> 00:31:08,302 line:90%,end
<c.magenta>在多个设备上到底发生了什么时</c>


719
00:31:08,368 --> 00:31:11,138 line:90%,end
<c.magenta>且在共享情况下可能有多个用户</c>
<c.magenta>这些用户间发生了什么</c>


720
00:31:11,972 --> 00:31:13,841 line:90%,end
<c.magenta>现在 在本例中 我们在实时日志中</c>


721
00:31:14,575 --> 00:31:16,677 line:90%,end
<c.magenta>但我们还有一个叫作日志历史的功能</c>


722
00:31:16,977 --> 00:31:19,947 line:90%,end
<c.magenta>这个允许你返回去</c>
<c.magenta>浏览过去所发生过的事件</c>


723
00:31:20,280 --> 00:31:22,216 line:90%,end
<c.magenta>我们最多可以把这些事件存上七天</c>


724
00:31:22,449 --> 00:31:23,584 line:90%,end
<c.magenta>你可以做比如说</c>


725
00:31:23,650 --> 00:31:27,321 line:90%,end
<c.magenta>给我显示昨天发生的全部事件</c>


726
00:31:27,487 --> 00:31:29,456 line:90%,end
<c.magenta>假如说在9点和10点之间</c>


727
00:31:29,857 --> 00:31:31,491 line:90%,end
<c.magenta>你可以提供更多的筛选器</c>


728
00:31:31,558 --> 00:31:34,695 line:90%,end
<c.magenta>这将会给你返回</c>
<c.magenta>符合那些筛选条件的事件</c>


729
00:31:36,296 --> 00:31:37,364 line:90%,end
<c.magenta>好的 我要谈的最后一个东西</c>


730
00:31:37,431 --> 00:31:39,633 line:90%,end
<c.magenta>是遥测</c>


731
00:31:40,267 --> 00:31:42,536 line:90%,end
<c.magenta>那么去年我们提供了</c>
<c.magenta>CloudKit Telemetry</c>


732
00:31:42,636 --> 00:31:44,338 line:90%,end
<c.magenta>今年我们扩展了</c>
<c.magenta>CloudKit Telemetry</c>


733
00:31:45,072 --> 00:31:49,476 line:90%,end
<c.magenta>提示一下 遥测技术是你理解</c>


734
00:31:49,743 --> 00:31:51,578 line:90%,end
<c.magenta>进入你的容器中的</c>


735
00:31:51,645 --> 00:31:53,046 line:90%,end
<c.magenta>发生在你所有用户设备上的</c>
<c.magenta>聚合行为的方式</c>


736
00:31:53,814 --> 00:31:55,949 line:90%,end
<c.magenta>在本例中 我们正处于开发环境下</c>


737
00:31:56,216 --> 00:31:57,518 line:90%,end
<c.magenta>那么我们可以看到</c>


738
00:31:57,584 --> 00:32:00,254 line:90%,end
<c.magenta>我在我们所演示的这个应用上</c>
<c.magenta>进行的一些操作的信息</c>


739
00:32:01,622 --> 00:32:03,056 line:90%,end
<c.magenta>你可以选择一个时间筛选器</c>


740
00:32:03,323 --> 00:32:06,927 line:90%,end
<c.magenta>所以你就可以选择去年</c>
<c.magenta>过去30天、昨天、</c>


741
00:32:06,994 --> 00:32:09,596 line:90%,end
<c.magenta>或者前一个小时</c>
<c.magenta>让我们选择前一个小时</c>


742
00:32:09,663 --> 00:32:11,932 line:90%,end
<c.magenta>因为我们是从那时</c>
<c.magenta>才开始用这款应用的</c>


743
00:32:13,500 --> 00:32:15,068 line:90%,end
<c.magenta>你可以请求</c>


744
00:32:15,135 --> 00:32:17,404 line:90%,end
<c.magenta>应用到每人的私密数据库</c>


745
00:32:17,571 --> 00:32:19,072 line:90%,end
<c.magenta>每个人的共享数据库</c>


746
00:32:19,306 --> 00:32:21,875 line:90%,end
<c.magenta>或公共数据库上的遥测信息</c>


747
00:32:22,976 --> 00:32:24,745 line:90%,end
<c.magenta>你还可以浏览</c>


748
00:32:24,811 --> 00:32:27,948 line:90%,end
<c.magenta>私密数据库中该时间窗口内</c>


749
00:32:28,015 --> 00:32:29,316 line:90%,end
<c.magenta>全部操作的遥测信息</c>


750
00:32:29,750 --> 00:32:32,252 line:90%,end
<c.magenta>我要谈谈操作的具体类型</c>


751
00:32:32,319 --> 00:32:34,454 line:90%,end
<c.magenta>以及在那个时间窗口范围内</c>
<c.magenta>每次有几个操作进入</c>


752
00:32:34,788 --> 00:32:35,722 line:90%,end
<c.magenta>那么你可能会说</c>


753
00:32:35,822 --> 00:32:37,524 line:90%,end
<c.magenta>“我只想看</c>


754
00:32:37,591 --> 00:32:39,393 line:90%,end
<c.magenta>记录修改操作的遥测信息 ”</c>


755
00:32:40,260 --> 00:32:42,563 line:90%,end
<c.magenta>但在本例中</c>
<c.magenta>让我们看一下全部操作的遥测信息</c>


756
00:32:43,697 --> 00:32:46,266 line:90%,end
<c.magenta>你在顶部看到的第一个图表叫作请求</c>


757
00:32:46,900 --> 00:32:49,837 line:90%,end
<c.magenta>它显示了进入到服务器中的全部请求</c>


758
00:32:49,903 --> 00:32:51,872 line:90%,end
<c.magenta>这些请求是在这个</c>
<c.magenta>具体的时间窗口范围内的</c>


759
00:32:51,939 --> 00:32:53,407 line:90%,end
<c.magenta>并且是私密数据库中的</c>


760
00:32:53,841 --> 00:32:57,377 line:90%,end
<c.magenta>以及在每个时间片段内</c>
<c.magenta>进入的每个类型的请求有多少个</c>


761
00:32:58,345 --> 00:33:01,014 line:90%,end
<c.magenta>请注意 这个图表叫作请求</c>
<c.magenta>而不是操作</c>


762
00:33:01,081 --> 00:33:02,749 line:90%,end
<c.magenta>这是因为 正如我之前所说过的</c>


763
00:33:02,883 --> 00:33:05,152 line:90%,end
<c.magenta>当你从API中发起操作时</c>


764
00:33:05,219 --> 00:33:07,955 line:90%,end
<c.magenta>有时候会导致多个请求</c>


765
00:33:08,121 --> 00:33:10,724 line:90%,end
<c.magenta>并且我们想让你查看全部请求</c>


766
00:33:11,725 --> 00:33:14,194 line:90%,end
<c.magenta>所以在这里</c>
<c.magenta>我们可以看到我做的记录修改</c>


767
00:33:14,261 --> 00:33:16,296 line:90%,end
<c.magenta>数据库变更、订阅修改</c>


768
00:33:16,530 --> 00:33:17,698 line:90%,end
<c.magenta>以及各自的数量</c>


769
00:33:18,332 --> 00:33:20,701 line:90%,end
<c.magenta>我们希望这能在开发中对你有所帮助</c>


770
00:33:20,868 --> 00:33:23,337 line:90%,end
<c.magenta>并帮助你了解</c>
<c.magenta>你发送了多少请求类型</c>


771
00:33:23,403 --> 00:33:25,138 line:90%,end
<c.magenta>当你开始测试和创建应用时</c>


772
00:33:26,173 --> 00:33:27,474 line:90%,end
<c.magenta>然后在生产环境中</c>


773
00:33:27,674 --> 00:33:29,243 line:90%,end
<c.magenta>我们稍后会看一些例子</c>


774
00:33:29,376 --> 00:33:31,478 line:90%,end
<c.magenta>我们真的希望它能让你监控</c>


775
00:33:31,545 --> 00:33:34,214 line:90%,end
<c.magenta>你的全部用户所发起的请求类型</c>


776
00:33:34,481 --> 00:33:36,783 line:90%,end
<c.magenta>从而核查一些东西 比如下降和上升</c>


777
00:33:36,917 --> 00:33:40,087 line:90%,end
<c.magenta>那可能意味着</c>
<c.magenta>在你发布新应用版本后存在一个漏洞</c>


778
00:33:42,189 --> 00:33:45,759 line:90%,end
<c.magenta>我稍微往下滚动一下</c>
<c.magenta>下一个图表叫作服务器延迟</c>


779
00:33:46,260 --> 00:33:48,795 line:90%,end
<c.magenta>在这里 我们再一次展示了</c>


780
00:33:48,862 --> 00:33:50,664 line:90%,end
<c.magenta>服务器花了多长时间来处理这些事件</c>


781
00:33:51,365 --> 00:33:53,734 line:90%,end
<c.magenta>我们展示的是50%和95%</c>


782
00:33:54,334 --> 00:33:56,336 line:90%,end
<c.magenta>提示一下 你可以进一步查看</c>


783
00:33:56,403 --> 00:33:59,173 line:90%,end
<c.magenta>服务器花了多少时间</c>
<c.magenta>来处理指定的操作类型</c>


784
00:33:59,640 --> 00:34:01,608 line:90%,end
<c.magenta>我提供这个信息的原因是</c>


785
00:34:01,675 --> 00:34:03,477 line:90%,end
<c.magenta>它会帮助你了解</c>


786
00:34:03,544 --> 00:34:06,446 line:90%,end
<c.magenta>服务器会花多少时间来处理</c>


787
00:34:06,513 --> 00:34:08,047 line:90%,end
<c.magenta>你向应用中所添加的操作类型</c>


788
00:34:08,447 --> 00:34:09,815 line:90%,end
<c.magenta>因此你可以选择合适的类型</c>


789
00:34:09,882 --> 00:34:12,018 line:90%,end
<c.magenta>取决于你尝试创建的用户体验</c>


790
00:34:13,820 --> 00:34:15,856 line:90%,end
<c.magenta>下一个图表叫作报错计数</c>


791
00:34:16,190 --> 00:34:18,125 line:90%,end
<c.magenta>这通常叫作报错率</c>


792
00:34:18,257 --> 00:34:21,228 line:90%,end
<c.magenta>用于展示有百分之多少的请求失败了</c>


793
00:34:21,527 --> 00:34:24,297 line:90%,end
<c.magenta>现在我们给出了</c>
<c.magenta>具体有多少个请求失败了</c>


794
00:34:24,697 --> 00:34:26,266 line:90%,end
<c.magenta>以及影响了多少个用户</c>


795
00:34:26,533 --> 00:34:28,268 line:90%,end
<c.magenta>还有报错的具体类型</c>


796
00:34:28,467 --> 00:34:30,469 line:90%,end
<c.magenta>那么在本例中</c>
<c.magenta>你可以看一下这个时间片段</c>


797
00:34:30,704 --> 00:34:31,572 line:90%,end
<c.magenta>那儿有一个报错</c>


798
00:34:31,638 --> 00:34:34,174 line:90%,end
<c.magenta>是一个冲突 代表我曾尝试更新一些</c>


799
00:34:34,241 --> 00:34:35,842 line:90%,end
<c.magenta>已经在服务器上更新了的东西</c>


800
00:34:36,009 --> 00:34:37,511 line:90%,end
<c.magenta>并且这个报错影响了一个用户</c>


801
00:34:38,645 --> 00:34:41,380 line:90%,end
<c.magenta>那么我们希望这个信息</c>
<c.magenta>可以让你进行检测</c>


802
00:34:41,447 --> 00:34:43,217 line:90%,end
<c.magenta>当你的应用中可能会存在问题</c>


803
00:34:43,350 --> 00:34:45,552 line:90%,end
<c.magenta>而导致更多的报错时 并了解</c>


804
00:34:45,619 --> 00:34:48,121 line:90%,end
<c.magenta>它可能会影响到你百分之多少的用户</c>


805
00:34:49,489 --> 00:34:52,759 line:90%,end
<c.magenta>最后 你仍然可以</c>
<c.magenta>访问你的平均请求大小</c>


806
00:34:53,025 --> 00:34:55,362 line:90%,end
<c.magenta>这会提供有多少数据正在进入服务器</c>


807
00:34:56,163 --> 00:34:58,332 line:90%,end
<c.magenta>这是在我的开发环境中</c>


808
00:34:58,999 --> 00:35:00,834 line:90%,end
<c.magenta>让我们跳回到幻灯片看</c>


809
00:35:00,901 --> 00:35:04,071 line:90%,end
<c.magenta>一下这些图表的一些示例截图</c>


810
00:35:05,305 --> 00:35:07,007 line:90%,end
<c.magenta>那么 这是一个请求图表</c>


811
00:35:07,474 --> 00:35:09,276 line:90%,end
<c.magenta>来自于你们发布的一个容器</c>


812
00:35:09,409 --> 00:35:10,978 line:90%,end
<c.magenta>你可以看到 在任何一天</c>


813
00:35:11,044 --> 00:35:14,081 line:90%,end
<c.magenta>他们在私密数据库中</c>
<c.magenta>执行大约230万记录获取操作</c>


814
00:35:14,314 --> 00:35:17,651 line:90%,end
<c.magenta>这是全部用户所作出的努力</c>


815
00:35:18,285 --> 00:35:20,621 line:90%,end
<c.magenta>有意思的是如果你看一下这个比例</c>


816
00:35:20,687 --> 00:35:22,523 line:90%,end
<c.magenta>你可以看到</c>


817
00:35:22,823 --> 00:35:24,791 line:90%,end
<c.magenta>工作日和周末的趋势</c>


818
00:35:25,492 --> 00:35:28,362 line:90%,end
<c.magenta>那么开发人员很可能会利用这个来</c>
<c.magenta>正如我所说的</c>


819
00:35:28,428 --> 00:35:32,332 line:90%,end
<c.magenta>监控峰值和谷值</c>
<c.magenta>这个行为所发生的变更</c>


820
00:35:32,399 --> 00:35:34,101 line:90%,end
<c.magenta>当他们发布新版本时</c>


821
00:35:34,535 --> 00:35:36,970 line:90%,end
<c.magenta>当然 如果你改变了</c>
<c.magenta>与CloudKit的交互方式</c>


822
00:35:37,037 --> 00:35:38,672 line:90%,end
<c.magenta>那么也许你期待一次变更</c>


823
00:35:40,874 --> 00:35:43,410 line:90%,end
<c.magenta>这时报错图表的示例</c>


824
00:35:44,144 --> 00:35:45,245 line:90%,end
<c.magenta>请注意他们有大约</c>


825
00:35:45,312 --> 00:35:48,448 line:10%
<c.magenta>每天有1500个未找到区的报错</c>


826
00:35:48,649 --> 00:35:50,684 line:10%
<c.magenta>但仅影响了大约55个用户</c>


827
00:35:50,751 --> 00:35:53,387 line:10%
<c.magenta>占他们整个用户基数的百分比非常小</c>


828
00:35:53,620 --> 00:35:54,755 line:10%
<c.magenta>那么它可能意味着</c>


829
00:35:54,855 --> 00:35:56,823 line:10%
<c.magenta>应用中可能存在极端情况</c>


830
00:35:56,957 --> 00:35:59,226 line:10%
<c.magenta>可能进入了一种非常诡异的状态</c>
<c.magenta>在那种状态下应用认为存在某个区</c>


831
00:35:59,293 --> 00:36:01,061 line:10%
<c.magenta>而实际上服务器中却并没有这个区</c>


832
00:36:02,496 --> 00:36:04,198 line:90%,end
<c.magenta>我们有CKError文档</c>


833
00:36:04,331 --> 00:36:06,900 line:90%,end
<c.magenta>列出了你可能看到的全部报错类型</c>


834
00:36:07,100 --> 00:36:10,470 line:90%,end
<c.magenta>我们更新了那个文档</c>
<c.magenta>描述了每个报错所代表的意义</c>


835
00:36:10,537 --> 00:36:12,739 line:90%,end
<c.magenta>以及你要如何在你的应用中</c>
<c.magenta>处理某个报错</c>


836
00:36:13,140 --> 00:36:15,075 line:90%,end
<c.magenta>那么你在这个图表中看到的报错</c>


837
00:36:15,142 --> 00:36:16,710 line:90%,end
<c.magenta>你可以去那个文档中查找相应的说明</c>


838
00:36:18,645 --> 00:36:21,215 line:90%,end
<c.magenta>我们还提供一些遥测信息</c>


839
00:36:21,281 --> 00:36:24,051 line:90%,end
<c.magenta>是关于CloudKit为你的应用</c>
<c.magenta>所发送的推送通知</c>


840
00:36:24,384 --> 00:36:25,385 line:90%,end
<c.magenta>这些是分离的</c>


841
00:36:25,452 --> 00:36:28,856 line:90%,end
<c.magenta>基于私密数据库、公共数据库</c>
<c.magenta>和共享数据库上的订阅</c>


842
00:36:29,456 --> 00:36:30,858 line:90%,end
<c.magenta>并且这也是一种合理性检测</c>


843
00:36:30,924 --> 00:36:33,360 line:90%,end
<c.magenta>如果用户抱怨说数据没有同步</c>


844
00:36:33,427 --> 00:36:34,528 line:90%,end
<c.magenta>你可以查看这里</c>
<c.magenta>你可以了解到情况还没那么糟糕</c>


845
00:36:34,595 --> 00:36:36,930 line:90%,end
<c.magenta>如果CloudKit仍然在发送推送通知</c>


846
00:36:37,097 --> 00:36:39,867 line:90%,end
<c.magenta>你应用中的订阅的配置也没什么问题</c>


847
00:36:41,869 --> 00:36:43,570 line:90%,end
<c.magenta>好的 那么我们今天都讲了什么？</c>


848
00:36:43,770 --> 00:36:46,707 line:90%,end
<c.magenta>嗯 我们发布了一个</c>
<c.magenta>全新的CloudKit Dashboard</c>


849
00:36:46,874 --> 00:36:48,509 line:90%,end
<c.magenta>我们希望你们看一看 用一用</c>


850
00:36:48,575 --> 00:36:49,810 line:90%,end
<c.magenta>并请给我们提供一些反馈</c>


851
00:36:49,877 --> 00:36:52,813 line:90%,end
<c.magenta>告诉我们它用起来如何</c>
<c.magenta>哪儿不好用 你还希望添加哪些功能</c>


852
00:36:53,881 --> 00:36:56,650 line:90%,end
<c.magenta>我们还发布了一个</c>
<c.magenta>新CKOperationGroup API</c>


853
00:36:57,217 --> 00:37:00,721 line:90%,end
<c.magenta>我们希望它能给你们提供帮助</c>


854
00:37:00,787 --> 00:37:03,056 line:90%,end
<c.magenta>尤其是当查看Dashboard上的日志</c>


855
00:37:03,190 --> 00:37:05,626 line:90%,end
<c.magenta>以了解到底是哪些代码</c>


856
00:37:05,726 --> 00:37:08,695 line:90%,end
<c.magenta>导致了哪个网络请求被传回服务器</c>


857
00:37:10,230 --> 00:37:11,698 line:90%,end
<c.magenta>正如我所说的 我们希望得到</c>
<c.magenta>你们的反馈 无论是好是坏</c>


858
00:37:11,765 --> 00:37:13,166 line:90%,end
<c.magenta>它会指导我们要做什么</c>


859
00:37:13,233 --> 00:37:15,936 line:90%,end
<c.magenta>请关注Radars 请在论坛上发帖子</c>
<c.magenta>让我们了解你们的想法</c>


860
00:37:17,304 --> 00:37:20,307 line:90%,end
<c.magenta>要获取更多信息</c>
<c.magenta>这是本场演讲的链接</c>


861
00:37:20,541 --> 00:37:22,843 line:90%,end
<c.magenta>我们还提供了一个邮箱地址</c>
<c.magenta>cloudkit@apple</c>


862
00:37:22,910 --> 00:37:26,113 line:90%,end
<c.magenta>若有任何问题 欢迎联系我们</c>


863
00:37:26,847 --> 00:37:28,248 line:90%,end
<c.magenta>就这样 非常感谢</c>


864
00:37:28,315 --> 00:37:29,750 line:90%,end
<c.magenta>祝你们在大会期间度过美好时光</c>

